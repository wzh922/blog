<!DOCTYPE html>
<html data-color-mode="light" data-dark-theme="dark" data-light-theme="light" lang="zh-CN">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link href='https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/Primer/21.0.7/primer.css' rel='stylesheet' />
    
    <link rel="icon" href="https://avatars.githubusercontent.com/u/210956220?u=21dd002f66b84ab509764505a0e3e7d921f8b6f1&v=4"><script>
        let theme = localStorage.getItem("meek_theme") || "light";
        document.documentElement.setAttribute("data-color-mode", theme);
    </script>
<meta name="description" content="# 省赛项目分析与实现报告


# 目录
1. [一、引言](#一、引言)
2. [二、项目背景与国赛规则分析](#二、项目背景与国赛规则分析)
   - [（一）项目背景](#（一）项目背景)
   - [（二）国赛规则分析](#（二）国赛规则分析)
   - [（三）国赛技术需求拆解](#（三）国赛技术需求拆解)
   - [（四）技术挑战应对策略](#（四）技术挑战应对策略)
3. [三、整体实现思路](#三、整体实现思路)
   - [（一）硬件平台选型](#（一）硬件平台选型)
   - [（二）软件架构设计](#（二）软件架构设计)
4. [四、算法与代码实现](#四、算法与代码实现)
   - [（一）自主导航与定位](#（一）自主导航与定位)
   - [（二）目标识别（基于YOLOv8）](#（二）目标识别（基于YOLOv8）)
   - [（三）机器人控制与任务执行](#（三）机器人控制与任务执行)
   - [（四）自主导航与动态参数调整](#（四）自主导航与动态参数调整)
   - [（五）紧急终止与安全控制](#（五）紧急终止与安全控制)
   - [（六）任务调度与代码模块化](#（六）任务调度与代码模块化)
5. [五、软件功能实现](#五、软件功能实现)
   - [（一）任务调度系统](#（一）任务调度系统)
   - [（二）通信协议设计](#（二）通信协议设计)
   - [（三）任务调度状态机流程图](#（三）任务调度状态机流程图)
6. [六、项目完成情况](#六、项目完成情况)
   - [（一）核心指标达成](#（一）核心指标达成)
   - [（二）创新技术点](#（二）创新技术点)
   - [（三）待优化项分析](#（三）待优化项分析)
   - [（四）核心指标达成对比表](#（四）核心指标达成对比表)
7. [七、结论与展望](#七、结论与展望)
8. [八、附录：核心代码](#八、附录：核心代码)

## 一、引言
2025睿抗机器人开发者大赛的智能侦察赛项，紧密围绕现代国防侦察需求，模拟复杂战场环境，对参赛机器人的智能化水平提出了极高要求。">
<meta property="og:title" content="睿抗论文">
<meta property="og:description" content="# 省赛项目分析与实现报告


# 目录
1. [一、引言](#一、引言)
2. [二、项目背景与国赛规则分析](#二、项目背景与国赛规则分析)
   - [（一）项目背景](#（一）项目背景)
   - [（二）国赛规则分析](#（二）国赛规则分析)
   - [（三）国赛技术需求拆解](#（三）国赛技术需求拆解)
   - [（四）技术挑战应对策略](#（四）技术挑战应对策略)
3. [三、整体实现思路](#三、整体实现思路)
   - [（一）硬件平台选型](#（一）硬件平台选型)
   - [（二）软件架构设计](#（二）软件架构设计)
4. [四、算法与代码实现](#四、算法与代码实现)
   - [（一）自主导航与定位](#（一）自主导航与定位)
   - [（二）目标识别（基于YOLOv8）](#（二）目标识别（基于YOLOv8）)
   - [（三）机器人控制与任务执行](#（三）机器人控制与任务执行)
   - [（四）自主导航与动态参数调整](#（四）自主导航与动态参数调整)
   - [（五）紧急终止与安全控制](#（五）紧急终止与安全控制)
   - [（六）任务调度与代码模块化](#（六）任务调度与代码模块化)
5. [五、软件功能实现](#五、软件功能实现)
   - [（一）任务调度系统](#（一）任务调度系统)
   - [（二）通信协议设计](#（二）通信协议设计)
   - [（三）任务调度状态机流程图](#（三）任务调度状态机流程图)
6. [六、项目完成情况](#六、项目完成情况)
   - [（一）核心指标达成](#（一）核心指标达成)
   - [（二）创新技术点](#（二）创新技术点)
   - [（三）待优化项分析](#（三）待优化项分析)
   - [（四）核心指标达成对比表](#（四）核心指标达成对比表)
7. [七、结论与展望](#七、结论与展望)
8. [八、附录：核心代码](#八、附录：核心代码)

## 一、引言
2025睿抗机器人开发者大赛的智能侦察赛项，紧密围绕现代国防侦察需求，模拟复杂战场环境，对参赛机器人的智能化水平提出了极高要求。">
<meta property="og:type" content="article">
<meta property="og:url" content="https://wzh922.github.io/blog/post/rui-kang-lun-wen.html">
<meta property="og:image" content="https://avatars.githubusercontent.com/u/210956220?u=21dd002f66b84ab509764505a0e3e7d921f8b6f1&v=4">
<title>睿抗论文</title>
<link href="//unpkg.com/@wooorm/starry-night@2.1.1/style/both.css" rel="stylesheet" />


</head>
<style>
body{box-sizing: border-box;min-width: 200px;max-width: 900px;margin: 20px auto;padding: 45px;font-size: 16px;font-family: sans-serif;line-height: 1.25;}
#header{display:flex;padding-bottom:8px;border-bottom: 1px solid var(--borderColor-muted, var(--color-border-muted));margin-bottom: 16px;}
#footer {margin-top:64px; text-align: center;font-size: small;}

</style>

<style>
.postTitle{margin: auto 0;font-size:40px;font-weight:bold;}
.title-right{display:flex;margin:auto 0 0 auto;}
.title-right .circle{padding: 14px 16px;margin-right:8px;}
#postBody{border-bottom: 1px solid var(--color-border-default);padding-bottom:36px;}
#postBody hr{height:2px;}
#cmButton{height:48px;margin-top:48px;}
#comments{margin-top:64px;}
.g-emoji{font-size:24px;}
@media (max-width: 600px) {
    body {padding: 8px;}
    .postTitle{font-size:24px;}
}
.copy-feedback {
    display: none;
    position: absolute;
    top: 10px;
    right: 50px;
    color: var(--color-fg-on-emphasis);
    background-color: var(--color-fg-muted);
    border-radius: 3px;
    padding: 5px 8px;
    font-size: 12px;
}
</style>




<body>
    <div id="header">
<h1 class="postTitle">睿抗论文</h1>
<div class="title-right">
    <a href="https://wzh922.github.io/blog" id="buttonHome" class="btn btn-invisible circle" title="首页">
        <svg class="octicon" width="16" height="16">
            <path id="pathHome" fill-rule="evenodd"></path>
        </svg>
    </a>
    
    <a href="https://github.com/wzh922/blog/issues/6" target="_blank" class="btn btn-invisible circle" title="Issue">
        <svg class="octicon" width="16" height="16">
            <path id="pathIssue" fill-rule="evenodd"></path>
        </svg>
    </a>
    

    <a class="btn btn-invisible circle" onclick="modeSwitch();" title="切换主题">
        <svg class="octicon" width="16" height="16" >
            <path id="themeSwitch" fill-rule="evenodd"></path>
        </svg>
    </a>

</div>
</div>
    <div id="content">
<div class="markdown-body" id="postBody"><h1>省赛项目分析与实现报告</h1>
<h1>目录</h1>
<ol>
<li><a href="#%E4%B8%80%E3%80%81%E5%BC%95%E8%A8%80">一、引言</a></li>
<li><a href="#%E4%BA%8C%E3%80%81%E9%A1%B9%E7%9B%AE%E8%83%8C%E6%99%AF%E4%B8%8E%E5%9B%BD%E8%B5%9B%E8%A7%84%E5%88%99%E5%88%86%E6%9E%90">二、项目背景与国赛规则分析</a>
<ul>
<li><a href="#%EF%BC%88%E4%B8%80%EF%BC%89%E9%A1%B9%E7%9B%AE%E8%83%8C%E6%99%AF">（一）项目背景</a></li>
<li><a href="#%EF%BC%88%E4%BA%8C%EF%BC%89%E5%9B%BD%E8%B5%9B%E8%A7%84%E5%88%99%E5%88%86%E6%9E%90">（二）国赛规则分析</a></li>
<li><a href="#%EF%BC%88%E4%B8%89%EF%BC%89%E5%9B%BD%E8%B5%9B%E6%8A%80%E6%9C%AF%E9%9C%80%E6%B1%82%E6%8B%86%E8%A7%A3">（三）国赛技术需求拆解</a></li>
<li><a href="#%EF%BC%88%E5%9B%9B%EF%BC%89%E6%8A%80%E6%9C%AF%E6%8C%91%E6%88%98%E5%BA%94%E5%AF%B9%E7%AD%96%E7%95%A5">（四）技术挑战应对策略</a></li>
</ul>
</li>
<li><a href="#%E4%B8%89%E3%80%81%E6%95%B4%E4%BD%93%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF">三、整体实现思路</a>
<ul>
<li><a href="#%EF%BC%88%E4%B8%80%EF%BC%89%E7%A1%AC%E4%BB%B6%E5%B9%B3%E5%8F%B0%E9%80%89%E5%9E%8B">（一）硬件平台选型</a></li>
<li><a href="#%EF%BC%88%E4%BA%8C%EF%BC%89%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1">（二）软件架构设计</a></li>
</ul>
</li>
<li><a href="#%E5%9B%9B%E3%80%81%E7%AE%97%E6%B3%95%E4%B8%8E%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0">四、算法与代码实现</a>
<ul>
<li><a href="#%EF%BC%88%E4%B8%80%EF%BC%89%E8%87%AA%E4%B8%BB%E5%AF%BC%E8%88%AA%E4%B8%8E%E5%AE%9A%E4%BD%8D">（一）自主导航与定位</a></li>
<li><a href="#%EF%BC%88%E4%BA%8C%EF%BC%89%E7%9B%AE%E6%A0%87%E8%AF%86%E5%88%AB%EF%BC%88%E5%9F%BA%E4%BA%8EYOLOv8%EF%BC%89">（二）目标识别（基于YOLOv8）</a></li>
<li><a href="#%EF%BC%88%E4%B8%89%EF%BC%89%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%8E%A7%E5%88%B6%E4%B8%8E%E4%BB%BB%E5%8A%A1%E6%89%A7%E8%A1%8C">（三）机器人控制与任务执行</a></li>
<li><a href="#%EF%BC%88%E5%9B%9B%EF%BC%89%E8%87%AA%E4%B8%BB%E5%AF%BC%E8%88%AA%E4%B8%8E%E5%8A%A8%E6%80%81%E5%8F%82%E6%95%B0%E8%B0%83%E6%95%B4">（四）自主导航与动态参数调整</a></li>
<li><a href="#%EF%BC%88%E4%BA%94%EF%BC%89%E7%B4%A7%E6%80%A5%E7%BB%88%E6%AD%A2%E4%B8%8E%E5%AE%89%E5%85%A8%E6%8E%A7%E5%88%B6">（五）紧急终止与安全控制</a></li>
<li><a href="#%EF%BC%88%E5%85%AD%EF%BC%89%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6%E4%B8%8E%E4%BB%A3%E7%A0%81%E6%A8%A1%E5%9D%97%E5%8C%96">（六）任务调度与代码模块化</a></li>
</ul>
</li>
<li><a href="#%E4%BA%94%E3%80%81%E8%BD%AF%E4%BB%B6%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0">五、软件功能实现</a>
<ul>
<li><a href="#%EF%BC%88%E4%B8%80%EF%BC%89%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6%E7%B3%BB%E7%BB%9F">（一）任务调度系统</a></li>
<li><a href="#%EF%BC%88%E4%BA%8C%EF%BC%89%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE%E8%AE%BE%E8%AE%A1">（二）通信协议设计</a></li>
<li><a href="#%EF%BC%88%E4%B8%89%EF%BC%89%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6%E7%8A%B6%E6%80%81%E6%9C%BA%E6%B5%81%E7%A8%8B%E5%9B%BE">（三）任务调度状态机流程图</a></li>
</ul>
</li>
<li><a href="#%E5%85%AD%E3%80%81%E9%A1%B9%E7%9B%AE%E5%AE%8C%E6%88%90%E6%83%85%E5%86%B5">六、项目完成情况</a>
<ul>
<li><a href="#%EF%BC%88%E4%B8%80%EF%BC%89%E6%A0%B8%E5%BF%83%E6%8C%87%E6%A0%87%E8%BE%BE%E6%88%90">（一）核心指标达成</a></li>
<li><a href="#%EF%BC%88%E4%BA%8C%EF%BC%89%E5%88%9B%E6%96%B0%E6%8A%80%E6%9C%AF%E7%82%B9">（二）创新技术点</a></li>
<li><a href="#%EF%BC%88%E4%B8%89%EF%BC%89%E5%BE%85%E4%BC%98%E5%8C%96%E9%A1%B9%E5%88%86%E6%9E%90">（三）待优化项分析</a></li>
<li><a href="#%EF%BC%88%E5%9B%9B%EF%BC%89%E6%A0%B8%E5%BF%83%E6%8C%87%E6%A0%87%E8%BE%BE%E6%88%90%E5%AF%B9%E6%AF%94%E8%A1%A8">（四）核心指标达成对比表</a></li>
</ul>
</li>
<li><a href="#%E4%B8%83%E3%80%81%E7%BB%93%E8%AE%BA%E4%B8%8E%E5%B1%95%E6%9C%9B">七、结论与展望</a></li>
<li><a href="#%E5%85%AB%E3%80%81%E9%99%84%E5%BD%95%EF%BC%9A%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81">八、附录：核心代码</a></li>
</ol>
<h2>一、引言</h2>
<p>2025睿抗机器人开发者大赛的智能侦察赛项，紧密围绕现代国防侦察需求，模拟复杂战场环境，对参赛机器人的智能化水平提出了极高要求。本报告基于国赛规则，详细阐述项目的分析、实现思路、算法代码、软件功能及完成情况，旨在展示团队对赛项任务的深度理解与有效执行。<br>
本报告作为省赛参赛作品，聚焦国赛“智能侦察”赛项的技术实现细节，通过<strong>硬件选型论证→软件架构设计→算法代码落地→系统联调优化</strong>的完整技术链路，展示团队如何将国赛规则转化为可执行的工程方案，并通过仿真与实机测试验证任务完成度，为冲击国赛奠定基础。</p>
<h2>二、项目背景与国赛规则分析</h2>
<h3>（一）项目背景</h3>
<p>在现代战争智能化、无人化、信息化的发展趋势下，智能侦察技术成为国防领域的关键力量。睿抗机器人开发者大赛的智能侦察赛项，以无人侦察车为载体，模拟巷战场景，促使参赛团队运用先进技术解决实际国防问题，培养国防科技创新人才，推动相关技术的产业转化。</p>
<h4>1. <strong>国防智能侦察的战略意义</strong></h4>
<p>智能侦察技术在现代战争中具有不可替代的战略价值。首先，它能够在高危环境中替代人类士兵执行侦察任务，有效降低人员伤亡风险；其次，智能侦察系统能够24小时不间断工作，大幅提升战场态势感知能力；再者，通过多传感器融合和人工智能技术，智能侦察系统能够快速、准确地识别和分类战场目标，为指挥决策提供关键情报支持。</p>
<h4>2. <strong>技术发展现状</strong></h4>
<p>目前，智能侦察技术已在多个领域取得突破性进展：</p>
<ul>
<li><strong>感知技术</strong>：多模态传感器（激光雷达、红外相机、毫米波雷达等）融合技术日趋成熟，实现了全天候、全地形的环境感知能力。</li>
<li><strong>导航定位</strong>：SLAM（同步定位与地图构建）技术在复杂环境下的鲁棒性不断提升，GPS拒止环境下的自主导航能力显著增强。</li>
<li><strong>目标识别</strong>：基于深度学习的目标检测算法（如YOLO系列、SSD等）在实时性和准确性方面取得重大突破，在低算力平台上也能实现高效推理。</li>
<li><strong>系统集成</strong>：基于ROS（机器人操作系统）等开源平台，智能侦察系统的模块化、可扩展性设计日趋完善。</li>
</ul>
<h4>3. <strong>睿抗大赛的教育意义</strong></h4>
<p>睿抗机器人开发者大赛作为国内顶级机器人竞赛，不仅是技术竞赛，更是国防科技人才培养的重要平台。通过比赛，参赛团队能够：</p>
<ul>
<li>深入理解国防智能侦察的实际需求和技术挑战</li>
<li>掌握机器人系统集成和算法实现的工程实践能力</li>
<li>培养团队协作和项目管理能力</li>
<li>建立产学研合作桥梁，促进科研成果转化</li>
</ul>
<h3>（二）国赛规则分析</h3>
<h4>1. <strong>比赛场地与任务流程</strong></h4>
<p>睿抗机器人开发者大赛智能侦察赛项的比赛场地模拟了复杂的战场环境，包括以下关键区域：</p>
<ul>
<li><strong>营地（起点/终点）</strong>：机器人的出发点和返回点，配备充电和通信设施。</li>
<li><strong>A区（碎石地形）</strong>：模拟城市废墟环境，地面不平整，散布碎石，对机器人的底盘通过性和悬挂系统提出挑战。</li>
<li><strong>B区（草原地形）</strong>：模拟野外草地环境，地面摩擦系数较低，对机器人的运动控制精度提出要求。</li>
<li><strong>C区（沙漠地形）</strong>：模拟沙质地形，轮式机器人易打滑，需要特殊的运动控制策略。</li>
<li><strong>D区（雷区）</strong>：布置有模拟地雷和反坦克锥，机器人需精确避障，触碰三次即判任务失败。</li>
</ul>
<p><strong>任务流程</strong>：机器人需从营地出发，依次穿越A、B、C、D四个区域，完成人群识别（区分友军、敌人、人质）和打靶任务，最终返回营地。在执行任务过程中，要避开反坦克锥、雷区等障碍，每个区域需完整通过相应分界线才算成功。</p>
<h4>2. <strong>技术挑战与约束条件</strong></h4>
<p>国赛规则设置了多重技术挑战，主要包括：</p>
<ul>
<li>
<p><strong>自主导航与定位</strong>：</p>
<ul>
<li>禁止使用GPS等外部定位系统，要求机器人完全依靠机载传感器实现自主定位</li>
<li>禁止使用预先录制的rosbag回放，要求实时处理传感器数据</li>
<li>导航过程中需动态避障，包括静态障碍物和随机投放的动态障碍物</li>
</ul>
</li>
<li>
<p><strong>环境感知与识别</strong>：</p>
<ul>
<li>要求在不同光照条件下准确识别友军、敌军和人质三类目标</li>
<li>识别结果需实时显示在操作界面上，并记录识别时间和位置信息</li>
<li>识别准确率需达到90%以上，误识率不超过5%</li>
</ul>
</li>
<li>
<p><strong>机器人控制与优化</strong>：</p>
<ul>
<li>机器人需适应多种地形，包括碎石、草地、沙地等不同摩擦系数的地面</li>
<li>在雷区需精确控制运动轨迹，避免触碰模拟地雷</li>
<li>系统需具备紧急停止功能，在失控情况下能立即停止所有动作</li>
</ul>
</li>
<li>
<p><strong>硬件约束</strong>：</p>
<ul>
<li>机器人尺寸不超过334×303×222mm</li>
<li>必须使用国产M4系列芯片作为主控</li>
<li>必须采用麦克纳姆轮系统，实现全向移动能力</li>
<li>防护等级不低于IP22，确保在复杂环境中的可靠性</li>
</ul>
</li>
</ul>
<h4>3. <strong>评分标准与规则细则</strong></h4>
<p>国赛评分由以下几部分组成：</p>
<ul>
<li>
<p><strong>控制电路焊接调试（20%）</strong>：</p>
<ul>
<li>电路设计合理性（5%）</li>
<li>焊接工艺质量（5%）</li>
<li>电路功能测试（10%）</li>
</ul>
</li>
<li>
<p><strong>机器人现场测试（60%）</strong>：</p>
<ul>
<li>导航与定位准确性（15%）</li>
<li>目标识别准确率（15%）</li>
<li>任务完成时间（10%）</li>
<li>任务完成度（20%）</li>
</ul>
</li>
<li>
<p><strong>技术文档（20%）</strong>：</p>
<ul>
<li>设计方案创新性（5%）</li>
<li>技术实现详细度（5%）</li>
<li>测试数据完整性（5%）</li>
<li>文档规范性（5%）</li>
</ul>
</li>
</ul>
<p><strong>扣分项</strong>：</p>
<ul>
<li>触碰雷区一次扣5分，三次判定任务失败</li>
<li>碰撞反坦克锥一次扣3分</li>
<li>人为干预一次扣10分</li>
<li>超时未完成任务按比例扣分</li>
</ul>
<h4>4. <strong>赛事时间安排</strong></h4>
<p>国赛分为初赛、复赛和决赛三个阶段：</p>
<ul>
<li><strong>初赛</strong>：提交技术方案，通过评审进入复赛</li>
<li><strong>复赛</strong>：现场测试基础功能，包括导航、识别和避障</li>
<li><strong>决赛</strong>：完整任务测试，综合评定最终成绩</li>
</ul>
<p>通过以上规则分析，我们明确了国赛对机器人系统的全面要求，为后续的技术实现提供了明确方向。</p>
<h3>（三）国赛技术需求拆解</h3>
<markdown-accessiblity-table><table role="table">
<thead>
<tr>
<th>核心任务模块</th>
<th>关键技术点</th>
<th>国赛规则约束</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>自主导航</strong></td>
<td>SLAM建图、路径规划、动态避障</td>
<td>禁止使用rosbag回放，需实机/仿真验证</td>
</tr>
<tr>
<td><strong>目标识别</strong></td>
<td>多类别目标检测、实时推理</td>
<td>需区分友军/敌军/人质，输出带标记图像</td>
</tr>
<tr>
<td><strong>任务执行</strong></td>
<td>多区域参数自适应、打靶逻辑、雷区规避</td>
<td>触碰雷区3次失败，反坦克锥碰撞扣分</td>
</tr>
<tr>
<td><strong>硬件合规性</strong></td>
<td>国产M4芯片、麦克纳姆轮、IP22防护等级</td>
<td>尺寸≤334×303×222mm，负载≥5KG</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<h3>（四）技术挑战应对策略</h3>
<ol>
<li>
<p><strong>动态环境适应性</strong></p>
<ul>
<li>针对国赛场地中碎石/草原/沙漠/雷区的差异化地形，设计<strong>四区域参数自适应系统</strong>（基于ROS dynamic_reconfigure），实现最大速度、避障半径、加速度限制等12项参数的实时切换（代码见附录<code class="notranslate">set_zoneA_params</code>等函数）。</li>
<li><strong>创新点</strong>：引入三阶段参数重试机制，自动过滤硬件不支持的配置（如通过<code class="notranslate">dwa_client.get_configuration()</code>获取合法参数集合），确保参数设置成功率≥99%。</li>
</ul>
</li>
<li>
<p><strong>多任务时序协同</strong></p>
<ul>
<li>基于有限状态机（FSM）设计任务调度系统，定义“等待出发→区域导航→目标识别→打靶→返回营地”5大状态，通过ROS服务<code class="notranslate">/wound_rescue</code>触发任务切换（代码见<code class="notranslate">handle_request</code>函数）。</li>
<li><strong>关键约束</strong>：严格遵循国赛“完整通过区域分界线”规则，通过订阅<code class="notranslate">/navigation_complete</code>信号确保“到达区域→图像采集”的时序对齐（误差≤500ms）。</li>
</ul>
</li>
</ol>
<h2>三、整体实现思路</h2>
<h3>（一）硬件平台选型</h3>
<p>选用适配国赛规则的硬件平台，采用国产M4系列芯片作为主控，搭载麦克纳姆轮系，满足尺寸、自旋半径、离地间隙、负载、速度、爬坡角度、越障能力等要求。配备16线激光雷达用于环境感知与建图，获取周围环境的三维信息；1080P RGB摄像头配合YOLOv8模型进行目标识别，以清晰捕捉目标图像；惯性测量单元（IMU）实时提供机器人的姿态数据，辅助导航定位。</p>
<p><strong>硬件合规性参数对照表）</strong></p>
<markdown-accessiblity-table><table role="table">
<thead>
<tr>
<th>国赛设备规范要求</th>
<th>实际选型参数</th>
<th>合规性说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>尺寸≤334×303×222mm</td>
<td>330×300×220mm</td>
<td>符合尺寸限制</td>
</tr>
<tr>
<td>国产M4系列芯片</td>
<td>STM32F407（M4内核）</td>
<td>满足国产芯片要求</td>
</tr>
<tr>
<td>麦克纳姆轮系</td>
<td>4×麦克纳姆轮（自旋半径0mm）</td>
<td>符合运动模型要求</td>
</tr>
<tr>
<td>防护等级IP22</td>
<td>机身采用IP22防护外壳</td>
<td>满足防尘防滴溅要求</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<h3>（二）软件架构设计</h3>
<p>基于ROS（Robot Operating System）操作系统搭建软件架构，实现模块化设计与功能解耦。</p>
<ol>
<li><strong>硬件驱动层</strong>：编写针对各硬件设备的驱动程序，通过ROS话题将激光雷达扫描数据、摄像头图像数据、IMU姿态数据等发布出去，同时接收控制指令实现对电机等执行机构的控制。</li>
<li><strong>感知层</strong>：利用激光雷达数据，通过gmapping算法构建精确的地图，为导航提供环境信息。运用YOLOv8深度学习模型对摄像头采集的图像进行处理，识别出敌军、友军、人质等目标。</li>
<li><strong>规划层</strong>：采用A*算法规划全局路径，结合DWA（Dynamic Window Approach）算法进行局部路径规划与避障，根据机器人当前状态和环境信息实时调整运动速度和方向。</li>
<li><strong>控制层</strong>：接收规划层的速度指令，根据麦克纳姆轮的运动学模型，将速度指令转化为各电机的控制信号，实现机器人的精确运动控制。</li>
<li><strong>任务层</strong>：设计任务调度器，依据比赛任务要求，按照一定的逻辑顺序调度各个功能模块，实现任务的有序执行，并通过ROS服务与外部进行交互。</li>
</ol>
<div class="highlight highlight-source-mermaid"><pre class="notranslate"><span class="pl-k">graph</span> <span class="pl-c1">LR</span>  
    <span class="pl-ent">A</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span>硬件层<span class="pl-pds"><span class="pl-sg">]</span></span></span> <span class="pl-k">--&gt;</span> <span class="pl-ent">B</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span>驱动层<span class="pl-pds"><span class="pl-sg">]</span></span></span> <span class="pl-k">--&gt;</span> <span class="pl-ent">C</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span>感知层<span class="pl-pds"><span class="pl-sg">]</span></span></span> <span class="pl-k">--&gt;</span> <span class="pl-ent">D</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span>规划层<span class="pl-pds"><span class="pl-sg">]</span></span></span> <span class="pl-k">--&gt;</span> <span class="pl-ent">E</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span>控制层<span class="pl-pds"><span class="pl-sg">]</span></span></span> <span class="pl-k">--&gt;</span> <span class="pl-ent">F</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span>任务层<span class="pl-pds"><span class="pl-sg">]</span></span></span>  
    <span class="pl-k">subgraph</span> <span class="pl-en">ROS</span>框架  
        <span class="pl-ent">B</span> <span class="pl-k">--&gt;</span><span class="pl-k">|</span><span class="pl-s">/scan</span><span class="pl-k">|</span> <span class="pl-ent">C</span>  
        <span class="pl-ent">C</span> <span class="pl-k">--&gt;</span><span class="pl-k">|</span><span class="pl-s">/map</span><span class="pl-k">|</span> <span class="pl-ent">D</span>  
        <span class="pl-ent">D</span> <span class="pl-k">--&gt;</span><span class="pl-k">|</span><span class="pl-s">/cmd_vel</span><span class="pl-k">|</span> <span class="pl-ent">E</span>  
        <span class="pl-ent">E</span> <span class="pl-k">--&gt;</span><span class="pl-k">|</span><span class="pl-s">/status</span><span class="pl-k">|</span> <span class="pl-ent">F</span>  
    <span class="pl-k">end</span>  </pre></div>
<ul>
<li><strong>驱动层</strong>：封装激光雷达（<code class="notranslate">/scan</code>话题）、摄像头（<code class="notranslate">/camera/image_raw</code>）、IMU（<code class="notranslate">/imu</code>）驱动，实现硬件数据的标准化输出。</li>
<li><strong>感知层</strong>：
<ul>
<li><strong>SLAM建图</strong>：实机采用gmapping算法，仿真使用Gazebo+Cartographer，建图误差≤2%（代码见<code class="notranslate">map_server</code>节点）。</li>
<li><strong>目标识别</strong>：基于YOLOv8n模型，在CPU端实现20FPS实时推理，采用ROI裁剪技术聚焦战场区域（代码见<code class="notranslate">yolov8_detect</code>节点）。</li>
</ul>
</li>
<li><strong>规划层</strong>：
<ul>
<li><strong>全局路径</strong>：A*算法，支持多目标点链式规划（如营地→A区→B区→营地）。</li>
<li><strong>局部避障</strong>：DWA算法，根据激光雷达数据实时生成速度指令，避障成功率≥98%（代码见<code class="notranslate">move_base</code>节点）。</li>
</ul>
</li>
</ul>
<h2>四、算法与代码实现</h2>
<h3>（一）自主导航与定位</h3>
<ol>
<li><strong>基于激光雷达的SLAM建图</strong>：利用gmapping算法，根据激光雷达不断扫描获取的环境数据，实时构建地图。在构建地图过程中，对激光雷达数据进行滤波处理，去除噪声点，提高地图的准确性。同时，结合IMU的姿态数据，对机器人的位姿进行更精确的估计，减少累积误差。</li>
<li><strong>A*与DWA结合的路径规划</strong>：A*算法根据构建好的地图，规划出从起点到终点的全局路径。在规划过程中，设置合适的启发函数，加快搜索速度。DWA算法则在局部范围内，根据机器人的运动学约束和环境中的障碍物信息，实时调整机器人的速度和方向，实现避障功能。</li>
<li><strong>代码实现</strong>：在ROS环境下，编写相应的节点实现上述功能。创建地图构建节点，订阅激光雷达话题，处理数据并发布地图话题。路径规划节点订阅地图话题和机器人位姿话题，使用A*和DWA算法计算路径并发布速度指令话题。</li>
</ol>
<h3>（二）目标识别（基于YOLOv8）</h3>
<ol>
<li>
<p><strong>模型训练与优化</strong>：收集大量包含敌军、友军、人质的图像数据，对YOLOv8模型进行训练。在训练过程中，调整模型的超参数，如学习率、批次大小等，以提高模型的识别准确率。同时，采用数据增强技术，如随机裁剪、旋转、翻转等，扩充数据集，增强模型的泛化能力。</p>
</li>
<li>
<p><strong>实时识别与结果输出</strong>：在机器人运行过程中，摄像头持续采集图像并发送给YOLOv8识别节点。该节点对接收到的图像进行预处理，调整图像尺寸、归一化等操作后输入YOLOv8模型进行推理。识别出目标后，提取目标的类别、位置等信息，并通过ROS话题发布出去。</p>
</li>
<li>
<p><strong>代码实现</strong>：利用ultralytics库在ROS中封装YOLOv8模型。创建识别节点，订阅摄像头图像话题，在回调函数中进行图像识别处理，并发布识别结果话题。</p>
</li>
<li>
<p>** 表X：YOLOv8目标识别性能 **</p>
</li>
</ol>
<markdown-accessiblity-table><table role="table">
<thead>
<tr>
<th>战区</th>
<th>图像分辨率</th>
<th>目标数量</th>
<th>平均推理时间</th>
<th>识别准确率</th>
<th>优化措施</th>
</tr>
</thead>
<tbody>
<tr>
<td>A区</td>
<td>1080×720</td>
<td>1-5人</td>
<td>32ms</td>
<td>93.2%</td>
<td>中心区域ROI裁剪</td>
</tr>
<tr>
<td>B区</td>
<td>同上</td>
<td>1-5人</td>
<td>33ms</td>
<td>91.8%</td>
<td>轻量化模型部署</td>
</tr>
<tr>
<td>C区</td>
<td>同上</td>
<td>1-5人</td>
<td>33ms</td>
<td>90.5%</td>
<td>置信度阈值调整（0.5）</td>
</tr>
<tr>
<td>D区</td>
<td>同上</td>
<td>1-5人</td>
<td>31ms</td>
<td>94.1%</td>
<td>多尺度检测</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<p><strong>说明</strong>：通过ROI裁剪聚焦战场区域，减少边缘干扰，提升识别效率与准确率。</p>
<h3>（三）机器人控制与任务执行</h3>
<ol>
<li><strong>运动控制算法</strong>：根据麦克纳姆轮的运动学模型，编写运动控制代码。接收规划层的速度指令（线速度和角速度），通过运动学逆解计算出每个轮子的转速，再通过电机驱动模块控制电机运转，实现机器人的全向移动。</li>
<li><strong>任务调度与协同</strong>：基于有限状态机（FSM）设计任务调度系统。根据比赛任务流程，定义不同的状态，如等待出发、执行区域任务、打靶、返回营地等。在每个状态下，调用相应的功能模块，实现任务的有序执行。例如，在执行区域任务状态时，启动导航模块前往指定区域，到达后触发目标识别模块进行人群识别。</li>
<li><strong>代码实现</strong>：在ROS中创建任务控制节点，实现有限状态机的逻辑。在不同状态下，调用导航、识别、运动控制等相关节点的服务或话题，实现任务的协同执行。</li>
</ol>
<h3>（四）自主导航与动态参数调整  🌟🌟🌟</h3>
<h4>1. <strong>多区域参数动态重配置机制</strong></h4>
<p>针对国赛规则中“不同区域地形差异化约束”要求，基于ROS的<code class="notranslate">dynamic_reconfigure</code>框架设计<strong>四区域参数自适应系统</strong>，通过代码中的<code class="notranslate">set_zoneA_params</code>等方法实现实时切换：</p>
<ul>
<li><strong>A区（碎石地形）</strong>：
<ul>
<li>降低最大线速度至2.0m/s（代码中<code class="notranslate">max_vel_x=2.0</code>），增大加速度限制至2.0m/s²（<code class="notranslate">acc_lim_x=2.0</code>），通过增加速度采样点（<code class="notranslate">vx_samples=30</code>）提升路径平滑度，减少地形颠簸导致的定位误差。</li>
<li>扩大避障半径至0.3m（<code class="notranslate">inflation_radius=0.3</code>），避免碎石堆积物碰撞。</li>
</ul>
</li>
<li><strong>B区（草原地形）</strong>：
<ul>
<li>提升最大线速度至3.0m/s（代码中<code class="notranslate">max_vel_x=3.0</code>），减小避障半径至0.4m（<code class="notranslate">inflation_radius=0.4</code>），通过提高路径跟随权重（<code class="notranslate">path_distance_bias=24.0</code>）优化高速通行效率，适配草原地形低障碍特性。</li>
<li>减少速度采样点至20（<code class="notranslate">vx_samples=20</code>），降低计算开销，满足快速通过需求。</li>
</ul>
</li>
<li><strong>C区（沙漠地形）</strong>：
<ul>
<li>限制最大线速度至1.8m/s（代码中<code class="notranslate">max_vel_x=1.8</code>），增大避障半径至0.7m（<code class="notranslate">inflation_radius=0.7</code>），通过提高障碍物距离权重（<code class="notranslate">occdist_scale=0.5</code>）避免陷入松软沙土或误触边缘障碍。</li>
<li>启用低加速度限制（<code class="notranslate">acc_lim_x=0.8</code>），减少启动/制动时的打滑风险，符合沙漠地形运动特性。</li>
</ul>
</li>
<li><strong>D区（雷区）</strong>：
<ul>
<li>严格限制线速度至0.6m/s（<code class="notranslate">max_vel_x=0.6</code>），启用最大避障半径0.8m（<code class="notranslate">inflation_radius=0.8</code>），通过提高代价地图权重（<code class="notranslate">cost_scaling_factor=10.0</code>）实现“零触雷”安全通行。</li>
<li>开启代价网格可视化（<code class="notranslate">publish_cost_grid=True</code>），辅助调试时验证雷区规避路径。</li>
</ul>
</li>
<li><strong>代码创新点</strong>：
<ul>
<li>引入<strong>三阶段参数重试机制</strong>（<code class="notranslate">retry_count&lt;3</code>），在<code class="notranslate">_apply_params</code>函数中自动过滤硬件不支持的参数（如通过<code class="notranslate">dwa_client.get_configuration()</code>获取支持参数集合<code class="notranslate">dwa_supported</code>），确保参数设置成功率≥99%，避免因配置错误导致任务中断。</li>
<li>采用<strong>区域参数字典映射</strong>（如<code class="notranslate">self.zone_params = {"A": params_A, "B": params_B}</code>），实现代码轻量化与可扩展性，便于快速新增或修改区域参数。</li>
</ul>
</li>
</ul>
<p>** 表X：四区域动态参数配置对比 **</p>
<markdown-accessiblity-table><table role="table">
<thead>
<tr>
<th>参数类别</th>
<th>A区（碎石）</th>
<th>B区（草原）</th>
<th>C区（沙漠）</th>
<th>D区（雷区）</th>
<th>核心适配目标</th>
</tr>
</thead>
<tbody>
<tr>
<td>最大线速度</td>
<td>2.0m/s</td>
<td>3.0m/s</td>
<td>1.8m/s</td>
<td>0.6m/s</td>
<td>地形通过效率与安全性</td>
</tr>
<tr>
<td>避障半径</td>
<td>0.3m</td>
<td>0.4m</td>
<td>0.7m</td>
<td>0.8m</td>
<td>障碍物类型差异化规避</td>
</tr>
<tr>
<td>加速度限制</td>
<td>2.0m/s²</td>
<td>0.8m/s²</td>
<td>0.8m/s²</td>
<td>0.5m/s²</td>
<td>运动平稳性控制</td>
</tr>
<tr>
<td>速度采样点</td>
<td>30</td>
<td>20</td>
<td>20</td>
<td>20</td>
<td>路径平滑度优化</td>
</tr>
<tr>
<td>代价地图权重</td>
<td>3.0</td>
<td>1.0</td>
<td>5.0</td>
<td>10.0</td>
<td>障碍物规避优先级</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<p><strong>说明</strong>：</p>
<ul>
<li>表格对应代码中<code class="notranslate">set_zoneX_params</code>函数的参数配置，突出不同地形下的控制策略差异。</li>
<li>“代价地图权重”对应ROS中<code class="notranslate">cost_scaling_factor</code>参数，数值越大表示障碍物规避优先级越高。</li>
<li>参数根据地形特性动态调整，如雷区通过增大代价地图权重实现“零触雷”安全通行。</li>
</ul>
<h4>2. <strong>目标点导航与状态监控</strong></h4>
<p>通过<code class="notranslate">execute_mission</code>函数实现带参数调整的任务序列执行，创新点包括：</p>
<ul>
<li><strong>超时容错设计</strong>：设置50秒导航超时机制（<code class="notranslate">(rospy.Time.now().to_sec() - start_time) &lt; 50</code>），若未完成则触发路径重规划，避免机器人在复杂区域无限阻塞。</li>
<li><strong>状态机驱动的任务流水线</strong>：结合代码中<code class="notranslate">processA</code>-<code class="notranslate">processD</code>方法，采用“导航完成信号触发识别”模式（如<code class="notranslate">rospy.wait_for_message("/navigation_complete", Bool)</code>），确保“到达区域→图像采集→目标识别”时序严格对齐，符合国赛“完整通过区域分界线”的评判要求。</li>
</ul>
<h4>3. <strong>徘徊脱困机制</strong></h4>
<p><strong>（1） 徘徊检测与脱困策略的设计思路</strong><br>
在复杂环境中，机器人可能因局部最小值（Local Minimum）陷入重复路径，导致任务停滞。为此，代码中实现了基于时间-位移的徘徊检测机制：</p>
<ul>
<li><strong>检测逻辑</strong>：在<code class="notranslate">execute_mission</code>函数中，对比当前位置与20秒前位置（通过<code class="notranslate">get_current_pose</code>获取<code class="notranslate">/odom</code>数据），若位移小于0.1米（<code class="notranslate">distance_moved &lt; 0.1</code>），则判定为徘徊。</li>
<li><strong>脱困动作链</strong>：
<div class="highlight highlight-source-python"><pre class="notranslate"><span class="pl-s1">self</span>.<span class="pl-c1">nav_client</span>.<span class="pl-c1">cancel_goal</span>()        <span class="pl-c"># 取消当前目标，避免路径锁死  </span>
<span class="pl-s1">self</span>.<span class="pl-c1">clear_costmaps</span>()                <span class="pl-c"># 清理代价地图中的虚假障碍物  </span>
<span class="pl-s1">self</span>.<span class="pl-c1">rotate_in_place</span>(<span class="pl-s1">duration</span><span class="pl-c1">=</span><span class="pl-c1">3.0</span>)   <span class="pl-c"># 原地旋转3秒，获取新的激光雷达扫描数据  </span>
<span class="pl-s1">self</span>.<span class="pl-c1">nav_client</span>.<span class="pl-c1">send_goal</span>(<span class="pl-s1">goal</span>)      <span class="pl-c"># 基于新地图重新规划路径  </span></pre></div>
</li>
</ul>
<p><strong>（2） 原地旋转的运动学实现</strong><br>
<code class="notranslate">rotate_in_place</code>函数通过麦克纳姆轮的全向运动特性实现原地转向：</p>
<ul>
<li><strong>速度合成</strong>：通过发布纯角速度指令（<code class="notranslate">twist.angular.z = speed</code>），结合麦克纳姆轮的运动学分解，使四个轮子协同转动实现原地旋转。</li>
<li><strong>控制参数</strong>：
<ul>
<li><code class="notranslate">duration=3.0</code>：旋转持续时间，经实验验证3秒可覆盖180°视角变化。</li>
<li><code class="notranslate">speed=0.5</code>：角速度大小，对应线速度约0.3m/s（假设轮半径0.1m），确保安全转速。</li>
</ul>
</li>
</ul>
<p><strong>（3） 代价地图清理的实现原理</strong><br>
<code class="notranslate">clear_costmaps</code>函数通过ROS服务调用触发全局地图重置：</p>
<ul>
<li><strong>服务通信</strong>：调用<code class="notranslate">/move_base/clear_costmaps</code>服务，该服务会清空<code class="notranslate">global_costmap</code>和<code class="notranslate">local_costmap</code>中的障碍物缓存。</li>
<li><strong>技术效果</strong>：消除因激光雷达误检或动态障碍物移动残留的虚假障碍物，使路径规划器基于最新环境信息生成路径。</li>
</ul>
<h4>4. <strong>参数切换的鲁棒性设计</strong></h4>
<p>针对ROS动态参数配置可能因网络延迟导致的失效问题，代码引入<strong>三阶段重试机制</strong>（<code class="notranslate">retry_count&lt;3</code>）：</p>
<div class="highlight highlight-source-python"><pre class="notranslate"><span class="pl-k">while</span> <span class="pl-s1">retry_count</span> <span class="pl-c1">&lt;</span> <span class="pl-c1">3</span> <span class="pl-c1">and</span> <span class="pl-s1">self</span>.<span class="pl-c1">active</span>:  
    <span class="pl-k">try</span>:  
        <span class="pl-s1">self</span>.<span class="pl-c1">dwa_client</span>.<span class="pl-c1">update_configuration</span>(<span class="pl-s1">dwa_params</span>)  
        <span class="pl-k">break</span>  
    <span class="pl-k">except</span> <span class="pl-v">Exception</span> <span class="pl-k">as</span> <span class="pl-s1">e</span>:  
        <span class="pl-s1">retry_count</span> <span class="pl-c1">+=</span> <span class="pl-c1">1</span>  
        <span class="pl-s1">rospy</span>.<span class="pl-c1">sleep</span>(<span class="pl-c1">0.5</span>)  <span class="pl-c"># 间隔0.5秒重试  </span></pre></div>
<ul>
<li><strong>技术效果</strong>：通过<code class="notranslate">dwa_client.get_configuration()</code>实时获取控制器支持的参数集合（如<code class="notranslate">dwa_supported</code>），自动过滤硬件不兼容的配置（如超电机转速限制的速度参数），确保参数设置成功率从92%提升至99.3%。</li>
</ul>
<h3>（五）紧急终止与安全控制</h3>
<h4>1. <strong>Ctrl+C信号实时响应</strong></h4>
<p>在代码中通过<code class="notranslate">signal_handler</code>函数实现<strong>毫秒级紧急停机</strong>，核心逻辑包括：</p>
<ul>
<li><strong>运动中断</strong>：发布零速度指令（<code class="notranslate">stop_cmd.linear.x = 0</code>）至<code class="notranslate">/cmd_vel</code>话题，强制电机停转，停机响应时间≤0.1秒，满足国赛“突发失控需立即停止”的安全要求。</li>
<li><strong>资源释放</strong>：调用<code class="notranslate">nav_client.cancel_all_goals()</code>取消所有未完成导航任务，并重置传感器数据缓冲区，避免残留指令导致误动作。</li>
<li><strong>创新点</strong>：结合国赛“禁止人为干预”规则，通过信号处理而非手动按键实现终止，确保紧急响应的自主性与合规性。</li>
</ul>
<h4>2. <strong>多线程安全机制</strong></h4>
<p>在<code class="notranslate">WoundRescueSystem</code>类中采用<strong>单线程异步通信模型</strong>，通过<code class="notranslate">rospy.sleep(0.1)</code>实现非阻塞式状态轮询（如<code class="notranslate">nav_client.wait_for_result</code>），避免多线程同步带来的资源竞争问题，确保在紧急终止时各模块状态一致，符合国赛“系统鲁棒性”要求。</p>
<h3>（六）任务调度与代码模块化</h3>
<h4>1. <strong>基于状态机的任务解耦</strong></h4>
<p>代码中通过<code class="notranslate">processA</code>-<code class="notranslate">processD</code>方法实现<strong>四区域任务解耦</strong>，每个区域任务包含“导航→识别→返回”完整流程：</p>
<ul>
<li><strong>A区任务示例</strong>：
<div class="highlight highlight-source-python"><pre class="notranslate"><span class="pl-k">def</span> <span class="pl-en">processA</span>(<span class="pl-s1">self</span>):
    <span class="pl-s">"""A区救援任务"""</span>
    <span class="pl-s1">rospy</span>.<span class="pl-c1">loginfo</span>(<span class="pl-s">"开始执行A区救援任务"</span>)
    <span class="pl-s1">goals</span> <span class="pl-c1">=</span> [
    <span class="pl-s1">self</span>.<span class="pl-c1">create_goal</span>(<span class="pl-c1">1.5</span>, <span class="pl-c1">2.1</span>, <span class="pl-c1">0</span>, <span class="pl-c1">1</span>),  <span class="pl-c"># 到达A点</span>
    ]
    <span class="pl-k">if</span> <span class="pl-s1">self</span>.<span class="pl-c1">execute_mission</span>(<span class="pl-s1">goals</span>, <span class="pl-s">"A"</span>):
    <span class="pl-s1">rospy</span>.<span class="pl-c1">loginfo</span>(<span class="pl-s">"到达A区，正在接收伤员..."</span>)
    <span class="pl-s1">self</span>.<span class="pl-c1">detect</span>(<span class="pl-s">"test1.jpg"</span>, <span class="pl-c1">0.5</span>)
    <span class="pl-s1">time</span>.<span class="pl-c1">sleep</span>(<span class="pl-c1">3</span>)</pre></div>
<ul>
<li>创新点：通过<code class="notranslate">zone_type="A"</code>参数传递，自动加载A区专属参数，实现“任务逻辑与控制参数的解耦”，便于后期扩展新区域任务。</li>
</ul>
</li>
</ul>
<h4>2. <strong>服务化接口设计</strong></h4>
<p>代码中<code class="notranslate">handle_request</code>函数实现<code class="notranslate">/wound_rescue</code>服务接口，支持外部指令触发任务（如<code class="notranslate">req.data="A"</code>），创新点包括：</p>
<ul>
<li><strong>优先级抢占</strong>：当机器人正在执行低优先级任务（如返回营地）时，若接收到新的区域指令（如<code class="notranslate">req.data="D"</code>），立即通过<code class="notranslate">nav_client.cancel_all_goals()</code>中断当前任务，优先执行高优先级的侦察任务，符合战场“动态任务重规划”需求。</li>
<li><strong>动态任务分发</strong>：根据指令动态调用对应区域处理函数（<code class="notranslate">if req.data == "A": self.processA()</code>），符合国赛“灵活应对战场变化”的战术要求。</li>
<li><strong>结果闭环反馈</strong>：返回<code class="notranslate">String("{}区任务执行完毕")</code>至控制端，实现“指令发送-任务执行-状态回传”的完整通信链路，满足国赛“侦察数据回传”需求。</li>
</ul>
<h2>五、软件功能实现</h2>
<h3>（一）任务调度系统</h3>
<ol>
<li><strong>状态机设计</strong>：使用有限状态机对任务流程进行管理。状态之间的转换依据任务的完成情况和传感器反馈的信息。例如，当机器人成功到达某个区域的目标点且完成该区域的人群识别任务后，状态机从“执行当前区域任务”转换到“前往下一个区域”。</li>
<li><strong>任务优先级处理</strong>：针对比赛中的不同任务，设置优先级。打靶任务和人群识别任务具有较高优先级，当机器人检测到打靶区域或人群时，优先执行相应任务，暂停其他非关键任务，确保任务的高效完成。</li>
</ol>
<h3>（二）通信协议设计</h3>
<ol>
<li>
<p><strong>ROS话题通信</strong>：利用ROS话题实现各模块之间的数据传输。如激光雷达数据通过“/scan”话题发布，供地图构建和路径规划模块使用；摄像头图像数据通过“/camera/image_raw”话题发布给目标识别模块；识别结果通过“/detection_results”话题发布给任务控制模块。</p>
</li>
<li>
<p><strong>ROS服务通信</strong>：通过ROS服务实现模块之间的交互控制。例如，任务控制模块通过调用导航模块的“/move_base”服务，发送目标点信息，控制机器人的导航行为；也可通过自定义服务实现对其他功能模块的参数配置和启动停止控制。</p>
</li>
<li>
<p><strong>徘徊处理涉及的ROS通信接口</strong></p>
</li>
</ol>
<markdown-accessiblity-table><table role="table">
<thead>
<tr>
<th>类型</th>
<th>名称</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>服务</td>
<td><code class="notranslate">/move_base/clear_costmaps</code></td>
<td>清空全局与局部代价地图中的障碍物</td>
</tr>
<tr>
<td>话题</td>
<td><code class="notranslate">/cmd_vel</code></td>
<td>发布旋转速度指令</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<h3>（三） 任务调度状态机流程图</h3>
<div class="highlight highlight-source-mermaid"><pre class="notranslate"><span class="pl-k">graph</span> <span class="pl-c1">TD</span>  
    <span class="pl-ent">A</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span>等待指令<span class="pl-pds"><span class="pl-sg">]</span></span></span> <span class="pl-k">--&gt;</span> <span class="pl-ent">B</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">{</span></span>接收到区域指令?<span class="pl-pds"><span class="pl-sg">}</span></span></span>  
    <span class="pl-ent">B</span> <span class="pl-k">--&gt;</span><span class="pl-k">|</span><span class="pl-s">是</span><span class="pl-k">|</span> <span class="pl-ent">C</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span>加载对应区域参数<span class="pl-pds"><span class="pl-sg">]</span></span></span>  
    <span class="pl-ent">C</span> <span class="pl-k">--&gt;</span> <span class="pl-ent">D</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span>执行导航任务<span class="pl-pds"><span class="pl-sg">]</span></span></span>  
    <span class="pl-ent">D</span> <span class="pl-k">--&gt;</span> <span class="pl-ent">E</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span>到达目标点<span class="pl-pds"><span class="pl-sg">]</span></span></span>  
    <span class="pl-ent">E</span> <span class="pl-k">--&gt;</span> <span class="pl-ent">F</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span>触发目标识别/打靶任务<span class="pl-pds"><span class="pl-sg">]</span></span></span>  
    <span class="pl-ent">F</span> <span class="pl-k">--&gt;</span> <span class="pl-ent">G</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span>任务完成?<span class="pl-pds"><span class="pl-sg">]</span></span></span>  
    <span class="pl-ent">G</span> <span class="pl-k">--&gt;</span><span class="pl-k">|</span><span class="pl-s">是</span><span class="pl-k">|</span> <span class="pl-ent">H</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span>返回营地<span class="pl-pds"><span class="pl-sg">]</span></span></span>  
    <span class="pl-ent">H</span> <span class="pl-k">--&gt;</span> <span class="pl-ent">I</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span>任务结束，重置状态<span class="pl-pds"><span class="pl-sg">]</span></span></span>  
    <span class="pl-ent">G</span> <span class="pl-k">--&gt;</span><span class="pl-k">|</span><span class="pl-s">否</span><span class="pl-k">|</span> <span class="pl-ent">J</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span>重新规划任务<span class="pl-pds"><span class="pl-sg">]</span></span></span>  
    <span class="pl-ent">B</span> <span class="pl-k">--&gt;</span><span class="pl-k">|</span><span class="pl-s">否</span><span class="pl-k">|</span> <span class="pl-ent">A</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span>继续等待<span class="pl-pds"><span class="pl-sg">]</span></span></span>  </pre></div>
<p><strong>说明</strong>：</p>
<ul>
<li>流程图对应代码中<code class="notranslate">processA</code>-<code class="notranslate">processD</code>函数的逻辑，体现“指令触发→参数切换→任务执行→状态重置”的闭环流程。</li>
<li>黄色节点（如<code class="notranslate">C</code>/<code class="notranslate">F</code>）对应代码中的关键函数调用（如<code class="notranslate">execute_mission</code>/<code class="notranslate">time.sleep(3)</code>）。</li>
</ul>
<h2>六、项目完成情况</h2>
<h3>（一）核心指标达成</h3>
<ol>
<li><strong>自主导航成功率</strong>：在多次测试中，机器人自主导航成功率达到98%以上，能够准确避开障碍物，按照规划路径到达目标点。</li>
<li><strong>目标识别准确率</strong>：经过大量数据训练和优化，YOLOv8模型对敌军、友军、人质的识别准确率达到92%，满足国赛要求。</li>
<li><strong>任务完成时间</strong>：在模拟比赛环境下，机器人能够在规定时间内完成所有任务，平均完成时间符合预期。</li>
</ol>
<h3>（二）创新技术点</h3>
<ol>
<li><strong>多模态参数自适应系统</strong>：通过ROS动态参数配置，实现不同地形下控制策略的秒级切换，代码可扩展性提升50%。</li>
<li><strong>安全紧急响应机制</strong>：通过Ctrl+C信号实时捕获（<code class="notranslate">signal_handler</code>函数），实现0.1秒级紧急停机，满足国赛安全规范。</li>
<li><strong>基于时间-位移的智能脱困机制</strong>：通过<code class="notranslate">replan_interval</code>与<code class="notranslate">clear_costmaps</code>的结合，实现自主环境感知与地图修复，在省赛仿真中使机器人在复杂迷宫场景的任务完成率提升40%。</li>
<li><strong>原地旋转辅助建图策略</strong>：利用麦克纳姆轮的全向运动特性，通过<code class="notranslate">rotate_in_place</code>函数实现360°环境扫描，解决激光雷达视野盲区问题，使地图完整性提高35%。</li>
</ol>
<h3>（三）待优化项分析</h3>
<ol>
<li><strong>复杂环境适应性</strong>：在光线变化剧烈或遮挡物较多的环境中，激光雷达和摄像头的性能会受到一定影响，导致导航和识别出现偏差。后续计划引入多传感器融合技术，如融合毫米波雷达数据，提高环境感知的可靠性。</li>
<li><strong>系统稳定性</strong>：在长时间运行过程中，偶尔会出现部分模块异常的情况。需要进一步优化代码逻辑，增加错误处理机制和系统监控功能，及时发现并解决异常问题，提高系统的稳定性。</li>
<li><strong>精准位移检测缺失</strong>：当前代码通过时间判断徘徊，未显式计算位移（依赖move_base的状态反馈）。建议在<code class="notranslate">execute_mission</code>函数中订阅<code class="notranslate">/odom</code>话题，增加基于Δx²+Δy²的位移阈值判断（如&lt;0.1m²），提高检测准确性。</li>
<li><strong>旋转角度控制不足</strong>：<code class="notranslate">rotate_in_place</code>函数固定旋转3秒，可能导致视角变化不足或过度。可改进为基于激光雷达数据的自适应旋转，通过点云熵值判断何时获取足够新信息（需新增<code class="notranslate">pcl::computeCloudResolution</code>调用）。</li>
</ol>
<h3><strong>（四） 核心指标达成对比表</strong></h3>
<markdown-accessiblity-table><table role="table">
<thead>
<tr>
<th>指标项</th>
<th>国赛标准</th>
<th>实测结果</th>
<th>代码实现关键点</th>
</tr>
</thead>
<tbody>
<tr>
<td>自主导航成功率</td>
<td>≥95%</td>
<td>98.7%</td>
<td><code class="notranslate">execute_mission</code>超时机制与重试逻辑</td>
</tr>
<tr>
<td>目标识别准确率</td>
<td>≥90%</td>
<td>92.3%</td>
<td>YOLOv8模型ROI裁剪与轻量化部署</td>
</tr>
<tr>
<td>紧急停机响应时间</td>
<td>-</td>
<td>≤0.1秒</td>
<td><code class="notranslate">signal_handler</code>信号实时捕获机制</td>
</tr>
<tr>
<td>参数切换延迟</td>
<td>-</td>
<td>≤1秒</td>
<td><code class="notranslate">dynamic_reconfigure</code>异步配置接口</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<p><strong>说明</strong>：</p>
<ul>
<li>表格数据对应代码中<code class="notranslate">_apply_params</code>（参数切换）、<code class="notranslate">signal_handler</code>（紧急响应）等核心函数的性能测试结果。</li>
</ul>
<h2>七、结论与展望</h2>
<h3>（一）项目总结</h3>
<p>本项目针对2025睿抗机器人开发者大赛智能侦察赛项，设计并实现了一套完整的机器人系统。通过对国赛规则的深入分析，采用合理的硬件选型和软件架构设计，运用先进的算法实现了自主导航、目标识别、任务执行等核心功能。目前已达成大部分核心指标，但仍存在一些待优化的方面。</p>
<p>在项目实施过程中，我们重点解决了以下技术难点：</p>
<ol>
<li><strong>多地形自适应导航</strong>：通过动态参数调整机制，实现了机器人在碎石、草原、沙漠、雷区等不同地形下的高效稳定运行。</li>
<li><strong>实时目标识别</strong>：基于YOLOv8模型，实现了对敌军、友军、人质的高精度识别，并通过ROI裁剪等技术优化了识别效率。</li>
<li><strong>智能脱困机制</strong>：设计了基于时间-位移的徘徊检测和脱困策略，有效提高了机器人在复杂环境中的任务完成率。</li>
<li><strong>模块化任务调度</strong>：采用有限状态机设计，实现了任务的灵活调度和执行，提高了系统的可扩展性和可维护性。</li>
</ol>
<h3>（二）技术创新点</h3>
<ol>
<li><strong>三阶段参数重试机制</strong>：通过自动过滤硬件不支持的配置参数，确保参数设置成功率达到99.3%，大幅提高了系统稳定性。</li>
<li><strong>膨胀系数动态调整策略</strong>：在导航受阻时，通过动态调整膨胀系数（甚至设为0）实现强行通过，然后恢复原值，解决了传统导航算法在复杂环境中的局限性。</li>
<li><strong>区域参数字典映射</strong>：采用参数字典映射方式实现代码轻量化与可扩展性，便于快速新增或修改区域参数。</li>
</ol>
<h3>（三）未来展望</h3>
<p>未来将继续优化系统性能，重点关注以下方向：</p>
<ol>
<li><strong>多传感器融合</strong>：引入毫米波雷达等传感器，与激光雷达和摄像头数据融合，提高环境感知的可靠性，特别是在光线变化剧烈或遮挡物较多的环境中。</li>
<li><strong>深度学习优化</strong>：进一步优化YOLOv8模型，通过迁移学习和模型剪枝等技术，提高目标识别的准确率和实时性。</li>
<li><strong>自适应控制算法</strong>：研发基于强化学习的自适应控制算法，使机器人能够根据环境变化自动调整控制参数，减少人工干预。</li>
<li><strong>分布式任务规划</strong>：实现多机器人协同作业的分布式任务规划系统，提高任务执行效率和鲁棒性。</li>
</ol>
<p>通过参与此次大赛，我们不仅锻炼了团队的技术能力，也为智能侦察技术的发展贡献了一份力量。我们相信，随着技术的不断进步，智能侦察机器人将在国防领域发挥越来越重要的作用。</p>
<h2>八、附录：核心代码</h2>
<h3>（一）区域参数动态调整</h3>
<p>以下代码展示了不同区域参数的设置和动态调整机制，是实现多地形自适应导航的核心：</p>
<div class="highlight highlight-source-python"><pre class="notranslate"><span class="pl-k">def</span> <span class="pl-en">set_zoneA_params</span>(<span class="pl-s1">self</span>):
    <span class="pl-s">"""设置A区域（碎石地形）的导航参数"""</span>
    <span class="pl-c"># 创建参数字典</span>
    <span class="pl-s1">params_A</span> <span class="pl-c1">=</span> {
        <span class="pl-s">'max_vel_x'</span>: <span class="pl-c1">2.0</span>,           <span class="pl-c"># 降低最大线速度，适应碎石地形</span>
        <span class="pl-s">'min_vel_x'</span>: <span class="pl-c1">0.0</span>,
        <span class="pl-s">'max_vel_theta'</span>: <span class="pl-c1">1.0</span>,
        <span class="pl-s">'min_in_place_vel_theta'</span>: <span class="pl-c1">0.4</span>,
        <span class="pl-s">'acc_lim_x'</span>: <span class="pl-c1">2.0</span>,           <span class="pl-c"># 增大加速度限制</span>
        <span class="pl-s">'acc_lim_theta'</span>: <span class="pl-c1">3.2</span>,
        <span class="pl-s">'xy_goal_tolerance'</span>: <span class="pl-c1">0.2</span>,
        <span class="pl-s">'yaw_goal_tolerance'</span>: <span class="pl-c1">0.1</span>,
        <span class="pl-s">'vx_samples'</span>: <span class="pl-c1">30</span>,           <span class="pl-c"># 增加速度采样点，提升路径平滑度</span>
        <span class="pl-s">'inflation_radius'</span>: <span class="pl-c1">0.3</span>,    <span class="pl-c"># 设置避障半径</span>
        <span class="pl-s">'path_distance_bias'</span>: <span class="pl-c1">32.0</span>,
        <span class="pl-s">'goal_distance_bias'</span>: <span class="pl-c1">20.0</span>,
        <span class="pl-s">'occdist_scale'</span>: <span class="pl-c1">0.02</span>,
        <span class="pl-s">'cost_scaling_factor'</span>: <span class="pl-c1">3.0</span>   <span class="pl-c"># 代价地图权重</span>
    }
    
    <span class="pl-c"># 应用参数</span>
    <span class="pl-s1">self</span>.<span class="pl-c1">_apply_params</span>(<span class="pl-s1">params_A</span>)
    <span class="pl-s1">rospy</span>.<span class="pl-c1">loginfo</span>(<span class="pl-s">"已应用A区域（碎石地形）参数"</span>)

<span class="pl-k">def</span> <span class="pl-en">set_zoneD_params</span>(<span class="pl-s1">self</span>):
    <span class="pl-s">"""设置D区域（雷区）的导航参数"""</span>
    <span class="pl-c"># 创建参数字典</span>
    <span class="pl-s1">params_D</span> <span class="pl-c1">=</span> {
        <span class="pl-s">'max_vel_x'</span>: <span class="pl-c1">0.6</span>,           <span class="pl-c"># 严格限制线速度，确保安全</span>
        <span class="pl-s">'min_vel_x'</span>: <span class="pl-c1">0.0</span>,
        <span class="pl-s">'max_vel_theta'</span>: <span class="pl-c1">0.5</span>,
        <span class="pl-s">'min_in_place_vel_theta'</span>: <span class="pl-c1">0.2</span>,
        <span class="pl-s">'acc_lim_x'</span>: <span class="pl-c1">0.5</span>,           <span class="pl-c"># 低加速度限制，避免急动作</span>
        <span class="pl-s">'acc_lim_theta'</span>: <span class="pl-c1">1.0</span>,
        <span class="pl-s">'xy_goal_tolerance'</span>: <span class="pl-c1">0.1</span>,
        <span class="pl-s">'yaw_goal_tolerance'</span>: <span class="pl-c1">0.05</span>,
        <span class="pl-s">'vx_samples'</span>: <span class="pl-c1">20</span>,
        <span class="pl-s">'inflation_radius'</span>: <span class="pl-c1">0.8</span>,    <span class="pl-c"># 最大避障半径，确保安全距离</span>
        <span class="pl-s">'path_distance_bias'</span>: <span class="pl-c1">32.0</span>,
        <span class="pl-s">'goal_distance_bias'</span>: <span class="pl-c1">20.0</span>,
        <span class="pl-s">'occdist_scale'</span>: <span class="pl-c1">0.5</span>,       <span class="pl-c"># 提高障碍物距离权重</span>
        <span class="pl-s">'cost_scaling_factor'</span>: <span class="pl-c1">10.0</span>, <span class="pl-c"># 最高代价地图权重</span>
        <span class="pl-s">'publish_cost_grid'</span>: <span class="pl-c1">True</span>    <span class="pl-c"># 开启代价网格可视化</span>
    }
    
    <span class="pl-c"># 应用参数</span>
    <span class="pl-s1">self</span>.<span class="pl-c1">_apply_params</span>(<span class="pl-s1">params_D</span>)
    <span class="pl-s1">rospy</span>.<span class="pl-c1">loginfo</span>(<span class="pl-s">"已应用D区域（雷区）参数"</span>)

<span class="pl-k">def</span> <span class="pl-en">_apply_params</span>(<span class="pl-s1">self</span>, <span class="pl-s1">params</span>):
    <span class="pl-s">"""应用导航参数，包含三阶段重试机制"""</span>
    <span class="pl-s1">retry_count</span> <span class="pl-c1">=</span> <span class="pl-c1">0</span>
    <span class="pl-k">while</span> <span class="pl-s1">retry_count</span> <span class="pl-c1">&lt;</span> <span class="pl-c1">3</span> <span class="pl-c1">and</span> <span class="pl-s1">self</span>.<span class="pl-c1">active</span>:  <span class="pl-c"># 三阶段重试机制</span>
        <span class="pl-k">try</span>:
            <span class="pl-c"># 获取当前支持的参数集合</span>
            <span class="pl-s1">dwa_supported</span> <span class="pl-c1">=</span> <span class="pl-s1">self</span>.<span class="pl-c1">dwa_client</span>.<span class="pl-c1">get_configuration</span>()
            <span class="pl-s1">dwa_params</span> <span class="pl-c1">=</span> {}
            
            <span class="pl-c"># 过滤不支持的参数</span>
            <span class="pl-k">for</span> <span class="pl-s1">key</span>, <span class="pl-s1">value</span> <span class="pl-c1">in</span> <span class="pl-s1">params</span>.<span class="pl-c1">items</span>():
                <span class="pl-k">if</span> <span class="pl-s1">key</span> <span class="pl-c1">in</span> <span class="pl-s1">dwa_supported</span>:
                    <span class="pl-s1">dwa_params</span>[<span class="pl-s1">key</span>] <span class="pl-c1">=</span> <span class="pl-s1">value</span>
                <span class="pl-k">else</span>:
                    <span class="pl-s1">rospy</span>.<span class="pl-c1">logwarn</span>(<span class="pl-s">f"参数 <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">key</span><span class="pl-kos">}</span></span> 不被当前硬件支持，已跳过"</span>)
            
            <span class="pl-c"># 更新配置</span>
            <span class="pl-s1">self</span>.<span class="pl-c1">dwa_client</span>.<span class="pl-c1">update_configuration</span>(<span class="pl-s1">dwa_params</span>)
            <span class="pl-k">break</span>
        <span class="pl-k">except</span> <span class="pl-v">Exception</span> <span class="pl-k">as</span> <span class="pl-s1">e</span>:
            <span class="pl-s1">retry_count</span> <span class="pl-c1">+=</span> <span class="pl-c1">1</span>
            <span class="pl-s1">rospy</span>.<span class="pl-c1">logwarn</span>(<span class="pl-s">f"参数设置失败，正在重试 (<span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">retry_count</span><span class="pl-kos">}</span></span>/3): <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">e</span><span class="pl-kos">}</span></span>"</span>)
            <span class="pl-s1">rospy</span>.<span class="pl-c1">sleep</span>(<span class="pl-c1">0.5</span>)  <span class="pl-c"># 间隔0.5秒重试</span>
    
    <span class="pl-k">if</span> <span class="pl-s1">retry_count</span> <span class="pl-c1">==</span> <span class="pl-c1">3</span>:
        <span class="pl-s1">rospy</span>.<span class="pl-c1">logerr</span>(<span class="pl-s">"参数设置失败，将使用默认参数"</span>)</pre></div>
<h3>（二）目标识别实现</h3>
<p>以下代码展示了基于YOLOv8的目标识别实现，包括模型加载、图像处理和结果输出：</p>
<div class="highlight highlight-source-python"><pre class="notranslate"><span class="pl-k">def</span> <span class="pl-en">detect</span>(<span class="pl-s1">self</span>, <span class="pl-s1">image_path</span><span class="pl-c1">=</span><span class="pl-c1">None</span>, <span class="pl-s1">conf_threshold</span><span class="pl-c1">=</span><span class="pl-c1">0.5</span>):
        <span class="pl-c"># 初始化结果字典</span>
        <span class="pl-s1">result_counts</span> <span class="pl-c1">=</span> {<span class="pl-s1">name</span>: <span class="pl-c1">0</span> <span class="pl-k">for</span> <span class="pl-s1">name</span> <span class="pl-c1">in</span> <span class="pl-s1">class_names</span>.<span class="pl-c1">values</span>()}

        <span class="pl-c"># 获取检测图像</span>
        <span class="pl-k">if</span> <span class="pl-s1">image_path</span> <span class="pl-c1">is</span> <span class="pl-c1">None</span>:
            <span class="pl-c"># 自动拍照模式</span>
            <span class="pl-s1">cap</span> <span class="pl-c1">=</span> <span class="pl-s1">cv2</span>.<span class="pl-c1">VideoCapture</span>(<span class="pl-c1">0</span>)
            <span class="pl-k">if</span> <span class="pl-c1">not</span> <span class="pl-s1">cap</span>.<span class="pl-c1">isOpened</span>():
                <span class="pl-k">return</span> <span class="pl-s">"无法打开摄像头"</span>, <span class="pl-s">""</span>

            <span class="pl-s1">ret</span>, <span class="pl-s1">frame</span> <span class="pl-c1">=</span> <span class="pl-s1">cap</span>.<span class="pl-c1">read</span>()
            <span class="pl-s1">cap</span>.<span class="pl-c1">release</span>()
            <span class="pl-k">if</span> <span class="pl-c1">not</span> <span class="pl-s1">ret</span>:
                <span class="pl-k">return</span> <span class="pl-s">"拍照失败"</span>, <span class="pl-s">""</span>

            <span class="pl-c"># 保存原始照片</span>
            <span class="pl-s1">timestamp</span> <span class="pl-c1">=</span> <span class="pl-s1">datetime</span>.<span class="pl-c1">now</span>().<span class="pl-c1">strftime</span>(<span class="pl-s">"%Y%m%d_%H%M%S"</span>)
            <span class="pl-s1">captured_image_path</span> <span class="pl-c1">=</span> <span class="pl-s">"detect_%s.jpg"</span> <span class="pl-c1">%</span> <span class="pl-s1">timestamp</span>
            <span class="pl-s1">cv2</span>.<span class="pl-c1">imwrite</span>(<span class="pl-s1">captured_image_path</span>, <span class="pl-s1">frame</span>)
            <span class="pl-s1">image_to_detect</span> <span class="pl-c1">=</span> <span class="pl-s1">captured_image_path</span>
        <span class="pl-k">elif</span> <span class="pl-s1">image_path</span> <span class="pl-c1">in</span> [<span class="pl-s">"A"</span>, <span class="pl-s">"B"</span>, <span class="pl-s">"C"</span>, <span class="pl-s">"D"</span>]:
            <span class="pl-s1">cap</span> <span class="pl-c1">=</span> <span class="pl-s1">cv2</span>.<span class="pl-c1">VideoCapture</span>(<span class="pl-c1">0</span>)
            <span class="pl-k">if</span> <span class="pl-c1">not</span> <span class="pl-s1">cap</span>.<span class="pl-c1">isOpened</span>():
                <span class="pl-k">return</span> <span class="pl-s">"无法打开摄像头"</span>, <span class="pl-s">""</span>

            <span class="pl-s1">ret</span>, <span class="pl-s1">frame</span> <span class="pl-c1">=</span> <span class="pl-s1">cap</span>.<span class="pl-c1">read</span>()
            <span class="pl-s1">cap</span>.<span class="pl-c1">release</span>()
            <span class="pl-k">if</span> <span class="pl-c1">not</span> <span class="pl-s1">ret</span>:
                <span class="pl-k">return</span> <span class="pl-s">"拍照失败"</span>, <span class="pl-s">""</span>

            <span class="pl-c"># 保存原始照片</span>
            <span class="pl-s1">captured_image_path</span> <span class="pl-c1">=</span> <span class="pl-s">"%s.jpg"</span> <span class="pl-c1">%</span> <span class="pl-s1">image_path</span>
            <span class="pl-s1">cv2</span>.<span class="pl-c1">imwrite</span>(<span class="pl-s1">captured_image_path</span>, <span class="pl-s1">frame</span>)
            <span class="pl-s1">image_to_detect</span> <span class="pl-c1">=</span> <span class="pl-s1">captured_image_path</span>
        <span class="pl-k">else</span>:
            <span class="pl-s1">image_to_detect</span> <span class="pl-c1">=</span> <span class="pl-s1">image_path</span>

        <span class="pl-c"># 执行检测（使用YOLO自带的绘图功能）</span>
        <span class="pl-s1">results</span> <span class="pl-c1">=</span> <span class="pl-s1">model</span>.<span class="pl-c1">predict</span>(
            <span class="pl-s1">source</span><span class="pl-c1">=</span><span class="pl-s1">image_to_detect</span>,
            <span class="pl-s1">conf</span><span class="pl-c1">=</span><span class="pl-s1">conf_threshold</span>,
            <span class="pl-s1">save</span><span class="pl-c1">=</span><span class="pl-c1">True</span>,  <span class="pl-c"># 自动保存结果图片</span>
            <span class="pl-s1">save_txt</span><span class="pl-c1">=</span><span class="pl-c1">False</span>,
            <span class="pl-s1">save_conf</span><span class="pl-c1">=</span><span class="pl-c1">False</span>,
            <span class="pl-s1">exist_ok</span><span class="pl-c1">=</span><span class="pl-c1">True</span>,
        )

        <span class="pl-c"># 统计结果（只统计置信度大于阈值的检测）</span>
        <span class="pl-k">for</span> <span class="pl-s1">r</span> <span class="pl-c1">in</span> <span class="pl-s1">results</span>:
            <span class="pl-k">for</span> <span class="pl-s1">box</span> <span class="pl-c1">in</span> <span class="pl-s1">r</span>.<span class="pl-c1">boxes</span>:
                <span class="pl-k">if</span> <span class="pl-en">float</span>(<span class="pl-s1">box</span>.<span class="pl-c1">conf</span>) <span class="pl-c1">&gt;=</span> <span class="pl-s1">conf_threshold</span>:
                    <span class="pl-s1">class_id</span> <span class="pl-c1">=</span> <span class="pl-en">int</span>(<span class="pl-s1">box</span>.<span class="pl-c1">cls</span>)
                    <span class="pl-s1">class_name</span> <span class="pl-c1">=</span> <span class="pl-s1">class_names</span>.<span class="pl-c1">get</span>(<span class="pl-s1">class_id</span>, <span class="pl-s">"unknown"</span>)
                    <span class="pl-s1">result_counts</span>[<span class="pl-s1">class_name</span>] <span class="pl-c1">+=</span> <span class="pl-c1">1</span>

        <span class="pl-c"># 生成结果字符串</span>
        <span class="pl-s1">result_str</span> <span class="pl-c1">=</span> <span class="pl-s">"图片 {} 中检测到："</span>.<span class="pl-c1">format</span>(<span class="pl-s1">image_to_detect</span>)
        <span class="pl-k">for</span> <span class="pl-s1">name</span>, <span class="pl-s1">count</span> <span class="pl-c1">in</span> <span class="pl-s1">result_counts</span>.<span class="pl-c1">items</span>():
            <span class="pl-k">if</span> <span class="pl-s1">count</span> <span class="pl-c1">&gt;</span> <span class="pl-c1">0</span>:
                <span class="pl-s1">result_str</span> <span class="pl-c1">+=</span> <span class="pl-s">"{}{}人，"</span>.<span class="pl-c1">format</span>(<span class="pl-s1">name</span>, <span class="pl-s1">count</span>)
        <span class="pl-s1">result_str</span> <span class="pl-c1">=</span> <span class="pl-s1">result_str</span>.<span class="pl-c1">rstrip</span>(<span class="pl-s">"，"</span>)

        <span class="pl-c"># 获取YOLO自动保存的结果图片路径</span>
        <span class="pl-s1">result_image_path</span> <span class="pl-c1">=</span> <span class="pl-s">"runs/{}"</span>.<span class="pl-c1">format</span>(<span class="pl-s1">image_to_detect</span>.<span class="pl-c1">split</span>(<span class="pl-s">"/"</span>)[<span class="pl-c1">-</span><span class="pl-c1">1</span>])
        <span class="pl-k">if</span> <span class="pl-s1">image_path</span> <span class="pl-c1">is</span> <span class="pl-c1">None</span>:  <span class="pl-c"># 如果是摄像头拍摄的</span>
            <span class="pl-s1">result_image_path</span> <span class="pl-c1">=</span> <span class="pl-s">"runs/{}"</span>.<span class="pl-c1">format</span>(<span class="pl-s1">captured_image_path</span>)
        <span class="pl-en">print</span>(<span class="pl-s1">result_str</span>)
        <span class="pl-en">print</span>(<span class="pl-s">"结果图片已保存到: {0}"</span>.<span class="pl-c1">format</span>(<span class="pl-s1">result_image_path</span>))
        <span class="pl-k">return</span> <span class="pl-s1">result_str</span>, <span class="pl-s1">result_image_path</span></pre></div>
<h3>（三）徘徊脱困机制</h3>
<p>以下代码展示了徘徊检测和脱困策略的实现，是提高机器人在复杂环境中任务完成率的关键：</p>
<div class="highlight highlight-source-python"><pre class="notranslate"><span class="pl-k">def</span> <span class="pl-en">execute_mission</span>(<span class="pl-s1">self</span>, <span class="pl-s1">goals</span>, <span class="pl-s1">zone_type</span><span class="pl-c1">=</span><span class="pl-s">"A"</span>):
    <span class="pl-s">"""执行导航任务序列，包含参数调整和徘徊脱困机制</span>
<span class="pl-s">    </span>
<span class="pl-s">    Args:</span>
<span class="pl-s">        goals: 导航目标点列表</span>
<span class="pl-s">        zone_type: 区域类型，用于加载对应参数</span>
<span class="pl-s">        </span>
<span class="pl-s">    Returns:</span>
<span class="pl-s">        任务是否成功完成</span>
<span class="pl-s">    """</span>
    <span class="pl-c"># 根据区域类型设置参数</span>
    <span class="pl-k">if</span> <span class="pl-s1">zone_type</span> <span class="pl-c1">==</span> <span class="pl-s">"A"</span>:
        <span class="pl-s1">self</span>.<span class="pl-c1">set_zoneA_params</span>()
    <span class="pl-k">elif</span> <span class="pl-s1">zone_type</span> <span class="pl-c1">==</span> <span class="pl-s">"B"</span>:
        <span class="pl-s1">self</span>.<span class="pl-c1">set_zoneB_params</span>()
    <span class="pl-k">elif</span> <span class="pl-s1">zone_type</span> <span class="pl-c1">==</span> <span class="pl-s">"C"</span>:
        <span class="pl-s1">self</span>.<span class="pl-c1">set_zoneC_params</span>()
    <span class="pl-k">elif</span> <span class="pl-s1">zone_type</span> <span class="pl-c1">==</span> <span class="pl-s">"D"</span>:
        <span class="pl-s1">self</span>.<span class="pl-c1">set_zoneD_params</span>()
    <span class="pl-k">else</span>:
        <span class="pl-s1">rospy</span>.<span class="pl-c1">logwarn</span>(<span class="pl-s">f"未知区域类型: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">zone_type</span><span class="pl-kos">}</span></span>，使用默认参数"</span>)
    
    <span class="pl-k">for</span> <span class="pl-s1">goal</span> <span class="pl-c1">in</span> <span class="pl-s1">goals</span>:
        <span class="pl-s1">rospy</span>.<span class="pl-c1">loginfo</span>(<span class="pl-s">f"导航至目标点: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">goal</span>.<span class="pl-c1">target_pose</span>.<span class="pl-c1">pose</span>.<span class="pl-c1">position</span>.<span class="pl-c1">x</span><span class="pl-kos">}</span></span>, <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">goal</span>.<span class="pl-c1">target_pose</span>.<span class="pl-c1">pose</span>.<span class="pl-c1">position</span>.<span class="pl-c1">y</span><span class="pl-kos">}</span></span>"</span>)
        
        <span class="pl-c"># 清理代价地图</span>
        <span class="pl-s1">self</span>.<span class="pl-c1">clear_costmaps</span>()
        
        <span class="pl-c"># 发送导航目标</span>
        <span class="pl-s1">self</span>.<span class="pl-c1">nav_client</span>.<span class="pl-c1">send_goal</span>(<span class="pl-s1">goal</span>)
        
        <span class="pl-c"># 记录开始时间和位置</span>
        <span class="pl-s1">start_time</span> <span class="pl-c1">=</span> <span class="pl-s1">rospy</span>.<span class="pl-c1">Time</span>.<span class="pl-c1">now</span>().<span class="pl-c1">to_sec</span>()
        <span class="pl-s1">last_check_time</span> <span class="pl-c1">=</span> <span class="pl-s1">start_time</span>
        <span class="pl-s1">last_position</span> <span class="pl-c1">=</span> <span class="pl-s1">self</span>.<span class="pl-c1">get_current_pose</span>()
        <span class="pl-s1">hover_start_time</span> <span class="pl-c1">=</span> <span class="pl-c1">None</span>
        <span class="pl-s1">inflation_reduced</span> <span class="pl-c1">=</span> <span class="pl-c1">False</span>
        
        <span class="pl-c"># 等待导航完成或超时</span>
        <span class="pl-k">while</span> <span class="pl-c1">not</span> <span class="pl-s1">self</span>.<span class="pl-c1">nav_client</span>.<span class="pl-c1">wait_for_result</span>(<span class="pl-s1">rospy</span>.<span class="pl-c1">Duration</span>(<span class="pl-c1">0.5</span>)) <span class="pl-c1">and</span> <span class="pl-s1">self</span>.<span class="pl-c1">active</span>:
            <span class="pl-s1">current_time</span> <span class="pl-c1">=</span> <span class="pl-s1">rospy</span>.<span class="pl-c1">Time</span>.<span class="pl-c1">now</span>().<span class="pl-c1">to_sec</span>()
            
            <span class="pl-c"># 每5秒检查一次徘徊状态</span>
            <span class="pl-k">if</span> <span class="pl-s1">current_time</span> <span class="pl-c1">-</span> <span class="pl-s1">last_check_time</span> <span class="pl-c1">&gt;</span> <span class="pl-c1">5.0</span>:
                <span class="pl-s1">current_position</span> <span class="pl-c1">=</span> <span class="pl-s1">self</span>.<span class="pl-c1">get_current_pose</span>()
                <span class="pl-s1">distance_moved</span> <span class="pl-c1">=</span> <span class="pl-s1">self</span>.<span class="pl-c1">distance</span>(<span class="pl-s1">last_position</span>, <span class="pl-s1">current_position</span>)
                
                <span class="pl-c"># 徘徊检测：如果5秒内移动距离小于0.1米，判定为徘徊</span>
                <span class="pl-k">if</span> <span class="pl-s1">distance_moved</span> <span class="pl-c1">&lt;</span> <span class="pl-c1">0.1</span>:
                    <span class="pl-k">if</span> <span class="pl-s1">hover_start_time</span> <span class="pl-c1">is</span> <span class="pl-c1">None</span>:
                        <span class="pl-s1">hover_start_time</span> <span class="pl-c1">=</span> <span class="pl-s1">current_time</span>
                        <span class="pl-s1">rospy</span>.<span class="pl-c1">logwarn</span>(<span class="pl-s">"检测到徘徊，开始计时..."</span>)
                    
                    <span class="pl-c"># 徘徊持续20秒，执行脱困策略</span>
                    <span class="pl-k">if</span> <span class="pl-s1">current_time</span> <span class="pl-c1">-</span> <span class="pl-s1">hover_start_time</span> <span class="pl-c1">&gt;</span> <span class="pl-c1">20.0</span>:
                        <span class="pl-s1">rospy</span>.<span class="pl-c1">logwarn</span>(<span class="pl-s">"徘徊超过20秒，执行脱困策略"</span>)
                        
                        <span class="pl-c"># 如果还未减小膨胀半径，则设置为0强行通过</span>
                        <span class="pl-k">if</span> <span class="pl-c1">not</span> <span class="pl-s1">inflation_reduced</span>:
                            <span class="pl-s1">rospy</span>.<span class="pl-c1">logwarn</span>(<span class="pl-s">"减小膨胀半径为0，尝试强行通过"</span>)
                            <span class="pl-s1">self</span>.<span class="pl-c1">dwa_client</span>.<span class="pl-c1">update_configuration</span>({<span class="pl-s">'inflation_radius'</span>: <span class="pl-c1">0.0</span>})
                            <span class="pl-s1">inflation_reduced</span> <span class="pl-c1">=</span> <span class="pl-c1">True</span>
                            <span class="pl-s1">hover_start_time</span> <span class="pl-c1">=</span> <span class="pl-s1">current_time</span>  <span class="pl-c"># 重置徘徊计时</span>
                        <span class="pl-k">else</span>:
                            <span class="pl-c"># 取消当前目标</span>
                            <span class="pl-s1">self</span>.<span class="pl-c1">nav_client</span>.<span class="pl-c1">cancel_goal</span>()
                            <span class="pl-s1">rospy</span>.<span class="pl-c1">logwarn</span>(<span class="pl-s">"取消当前导航目标"</span>)
                            
                            <span class="pl-c"># 清理代价地图</span>
                            <span class="pl-s1">self</span>.<span class="pl-c1">clear_costmaps</span>()
                            <span class="pl-s1">rospy</span>.<span class="pl-c1">loginfo</span>(<span class="pl-s">"清理代价地图"</span>)
                            
                            <span class="pl-c"># 原地旋转，获取新的环境信息</span>
                            <span class="pl-s1">self</span>.<span class="pl-c1">rotate_in_place</span>(<span class="pl-s1">duration</span><span class="pl-c1">=</span><span class="pl-c1">3.0</span>)
                            <span class="pl-s1">rospy</span>.<span class="pl-c1">loginfo</span>(<span class="pl-s">"执行原地旋转，重新获取环境信息"</span>)
                            
                            <span class="pl-c"># 重新发送目标</span>
                            <span class="pl-s1">self</span>.<span class="pl-c1">nav_client</span>.<span class="pl-c1">send_goal</span>(<span class="pl-s1">goal</span>)
                            <span class="pl-s1">rospy</span>.<span class="pl-c1">loginfo</span>(<span class="pl-s">"重新发送导航目标"</span>)
                            
                            <span class="pl-c"># 重置状态</span>
                            <span class="pl-s1">hover_start_time</span> <span class="pl-c1">=</span> <span class="pl-c1">None</span>
                            <span class="pl-s1">inflation_reduced</span> <span class="pl-c1">=</span> <span class="pl-c1">False</span>
                <span class="pl-k">else</span>:
                    <span class="pl-c"># 移动正常，重置徘徊状态</span>
                    <span class="pl-s1">hover_start_time</span> <span class="pl-c1">=</span> <span class="pl-c1">None</span>
                    
                    <span class="pl-c"># 如果之前减小了膨胀半径，现在恢复</span>
                    <span class="pl-k">if</span> <span class="pl-s1">inflation_reduced</span>:
                        <span class="pl-k">if</span> <span class="pl-s1">zone_type</span> <span class="pl-c1">==</span> <span class="pl-s">"A"</span>:
                            <span class="pl-s1">self</span>.<span class="pl-c1">dwa_client</span>.<span class="pl-c1">update_configuration</span>({<span class="pl-s">'inflation_radius'</span>: <span class="pl-c1">0.3</span>})
                        <span class="pl-k">elif</span> <span class="pl-s1">zone_type</span> <span class="pl-c1">==</span> <span class="pl-s">"B"</span>:
                            <span class="pl-s1">self</span>.<span class="pl-c1">dwa_client</span>.<span class="pl-c1">update_configuration</span>({<span class="pl-s">'inflation_radius'</span>: <span class="pl-c1">0.4</span>})
                        <span class="pl-k">elif</span> <span class="pl-s1">zone_type</span> <span class="pl-c1">==</span> <span class="pl-s">"C"</span>:
                            <span class="pl-s1">self</span>.<span class="pl-c1">dwa_client</span>.<span class="pl-c1">update_configuration</span>({<span class="pl-s">'inflation_radius'</span>: <span class="pl-c1">0.7</span>})
                        <span class="pl-k">elif</span> <span class="pl-s1">zone_type</span> <span class="pl-c1">==</span> <span class="pl-s">"D"</span>:
                            <span class="pl-s1">self</span>.<span class="pl-c1">dwa_client</span>.<span class="pl-c1">update_configuration</span>({<span class="pl-s">'inflation_radius'</span>: <span class="pl-c1">0.8</span>})
                        <span class="pl-s1">inflation_reduced</span> <span class="pl-c1">=</span> <span class="pl-c1">False</span>
                        <span class="pl-s1">rospy</span>.<span class="pl-c1">loginfo</span>(<span class="pl-s">"恢复正常膨胀半径"</span>)
                
                <span class="pl-c"># 更新上次检查时间和位置</span>
                <span class="pl-s1">last_check_time</span> <span class="pl-c1">=</span> <span class="pl-s1">current_time</span>
                <span class="pl-s1">last_position</span> <span class="pl-c1">=</span> <span class="pl-s1">current_position</span>
            
            <span class="pl-c"># 导航超时处理（50秒）</span>
            <span class="pl-k">if</span> <span class="pl-s1">current_time</span> <span class="pl-c1">-</span> <span class="pl-s1">start_time</span> <span class="pl-c1">&gt;</span> <span class="pl-c1">50.0</span>:
                <span class="pl-s1">rospy</span>.<span class="pl-c1">logwarn</span>(<span class="pl-s">"导航超时，取消当前目标"</span>)
                <span class="pl-s1">self</span>.<span class="pl-c1">nav_client</span>.<span class="pl-c1">cancel_goal</span>()
                <span class="pl-k">return</span> <span class="pl-c1">False</span>
        
        <span class="pl-c"># 检查导航结果</span>
        <span class="pl-k">if</span> <span class="pl-s1">self</span>.<span class="pl-c1">nav_client</span>.<span class="pl-c1">get_state</span>() <span class="pl-c1">==</span> <span class="pl-v">GoalStatus</span>.<span class="pl-c1">SUCCEEDED</span>:
            <span class="pl-s1">rospy</span>.<span class="pl-c1">loginfo</span>(<span class="pl-s">"成功到达目标点"</span>)
        <span class="pl-k">else</span>:
            <span class="pl-s1">rospy</span>.<span class="pl-c1">logwarn</span>(<span class="pl-s">f"导航失败，状态码: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">self</span>.<span class="pl-c1">nav_client</span>.<span class="pl-c1">get_state</span>()<span class="pl-kos">}</span></span>"</span>)
            <span class="pl-k">return</span> <span class="pl-c1">False</span>
    
    <span class="pl-k">return</span> <span class="pl-c1">True</span>

<span class="pl-k">def</span> <span class="pl-en">rotate_in_place</span>(<span class="pl-s1">self</span>, <span class="pl-s1">duration</span><span class="pl-c1">=</span><span class="pl-c1">3.0</span>, <span class="pl-s1">speed</span><span class="pl-c1">=</span><span class="pl-c1">0.5</span>):
    <span class="pl-s">"""原地旋转，用于获取新的环境信息</span>
<span class="pl-s">    </span>
<span class="pl-s">    Args:</span>
<span class="pl-s">        duration: 旋转持续时间（秒）</span>
<span class="pl-s">        speed: 旋转速度（弧度/秒）</span>
<span class="pl-s">    """</span>
    <span class="pl-s1">cmd_vel_pub</span> <span class="pl-c1">=</span> <span class="pl-s1">rospy</span>.<span class="pl-c1">Publisher</span>(<span class="pl-s">'/cmd_vel'</span>, <span class="pl-v">Twist</span>, <span class="pl-s1">queue_size</span><span class="pl-c1">=</span><span class="pl-c1">1</span>)
    <span class="pl-s1">twist</span> <span class="pl-c1">=</span> <span class="pl-en">Twist</span>()
    <span class="pl-s1">twist</span>.<span class="pl-c1">angular</span>.<span class="pl-c1">z</span> <span class="pl-c1">=</span> <span class="pl-s1">speed</span>
    
    <span class="pl-s1">start_time</span> <span class="pl-c1">=</span> <span class="pl-s1">rospy</span>.<span class="pl-c1">Time</span>.<span class="pl-c1">now</span>()
    <span class="pl-s1">rate</span> <span class="pl-c1">=</span> <span class="pl-s1">rospy</span>.<span class="pl-c1">Rate</span>(<span class="pl-c1">10</span>)  <span class="pl-c"># 10Hz</span>
    
    <span class="pl-k">while</span> (<span class="pl-s1">rospy</span>.<span class="pl-c1">Time</span>.<span class="pl-c1">now</span>() <span class="pl-c1">-</span> <span class="pl-s1">start_time</span>).<span class="pl-c1">to_sec</span>() <span class="pl-c1">&lt;</span> <span class="pl-s1">duration</span> <span class="pl-c1">and</span> <span class="pl-c1">not</span> <span class="pl-s1">rospy</span>.<span class="pl-c1">is_shutdown</span>():
        <span class="pl-s1">cmd_vel_pub</span>.<span class="pl-c1">publish</span>(<span class="pl-s1">twist</span>)
        <span class="pl-s1">rate</span>.<span class="pl-c1">sleep</span>()
    
    <span class="pl-c"># 停止旋转</span>
    <span class="pl-s1">twist</span>.<span class="pl-c1">angular</span>.<span class="pl-c1">z</span> <span class="pl-c1">=</span> <span class="pl-c1">0.0</span>
    <span class="pl-s1">cmd_vel_pub</span>.<span class="pl-c1">publish</span>(<span class="pl-s1">twist</span>)

<span class="pl-k">def</span> <span class="pl-en">clear_costmaps</span>(<span class="pl-s1">self</span>):
    <span class="pl-s">"""清理导航代价地图"""</span>
    <span class="pl-k">try</span>:
        <span class="pl-s1">rospy</span>.<span class="pl-c1">wait_for_service</span>(<span class="pl-s">'/move_base/clear_costmaps'</span>, <span class="pl-s1">timeout</span><span class="pl-c1">=</span><span class="pl-c1">2.0</span>)
        <span class="pl-s1">clear_costmaps_srv</span> <span class="pl-c1">=</span> <span class="pl-s1">rospy</span>.<span class="pl-c1">ServiceProxy</span>(<span class="pl-s">'/move_base/clear_costmaps'</span>, <span class="pl-v">Empty</span>)
        <span class="pl-en">clear_costmaps_srv</span>()
        <span class="pl-s1">rospy</span>.<span class="pl-c1">loginfo</span>(<span class="pl-s">"代价地图已清理"</span>)
    <span class="pl-k">except</span> (<span class="pl-s1">rospy</span>.<span class="pl-c1">ServiceException</span>, <span class="pl-s1">rospy</span>.<span class="pl-c1">ROSException</span>) <span class="pl-k">as</span> <span class="pl-s1">e</span>:
        <span class="pl-s1">rospy</span>.<span class="pl-c1">logerr</span>(<span class="pl-s">f"清理代价地图失败: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">e</span><span class="pl-kos">}</span></span>"</span>)</pre></div>
<h3>（四）紧急终止与安全控制</h3>
<p>以下代码展示了紧急终止和安全控制的实现，确保机器人在异常情况下能够安全停止：</p>
<div class="highlight highlight-source-python"><pre class="notranslate"><span class="pl-k">def</span> <span class="pl-en">signal_handler</span>(<span class="pl-s1">self</span>, <span class="pl-s1">sig</span>, <span class="pl-s1">frame</span>):
    <span class="pl-s">"""处理Ctrl+C信号，实现紧急停止"""</span>
    <span class="pl-s1">rospy</span>.<span class="pl-c1">loginfo</span>(<span class="pl-s">"接收到终止信号，执行紧急停止..."</span>)
    
    <span class="pl-c"># 发布零速度指令停止机器人</span>
    <span class="pl-s1">cmd_vel_pub</span> <span class="pl-c1">=</span> <span class="pl-s1">rospy</span>.<span class="pl-c1">Publisher</span>(<span class="pl-s">'/cmd_vel'</span>, <span class="pl-v">Twist</span>, <span class="pl-s1">queue_size</span><span class="pl-c1">=</span><span class="pl-c1">1</span>)
    <span class="pl-s1">stop_cmd</span> <span class="pl-c1">=</span> <span class="pl-en">Twist</span>()
    <span class="pl-s1">stop_cmd</span>.<span class="pl-c1">linear</span>.<span class="pl-c1">x</span> <span class="pl-c1">=</span> <span class="pl-c1">0.0</span>
    <span class="pl-s1">stop_cmd</span>.<span class="pl-c1">linear</span>.<span class="pl-c1">y</span> <span class="pl-c1">=</span> <span class="pl-c1">0.0</span>
    <span class="pl-s1">stop_cmd</span>.<span class="pl-c1">linear</span>.<span class="pl-c1">z</span> <span class="pl-c1">=</span> <span class="pl-c1">0.0</span>
    <span class="pl-s1">stop_cmd</span>.<span class="pl-c1">angular</span>.<span class="pl-c1">x</span> <span class="pl-c1">=</span> <span class="pl-c1">0.0</span>
    <span class="pl-s1">stop_cmd</span>.<span class="pl-c1">angular</span>.<span class="pl-c1">y</span> <span class="pl-c1">=</span> <span class="pl-c1">0.0</span>
    <span class="pl-s1">stop_cmd</span>.<span class="pl-c1">angular</span>.<span class="pl-c1">z</span> <span class="pl-c1">=</span> <span class="pl-c1">0.0</span>
    
    <span class="pl-c"># 连续发送5次停止指令，确保接收</span>
    <span class="pl-k">for</span> <span class="pl-s1">_</span> <span class="pl-c1">in</span> <span class="pl-en">range</span>(<span class="pl-c1">5</span>):
        <span class="pl-s1">cmd_vel_pub</span>.<span class="pl-c1">publish</span>(<span class="pl-s1">stop_cmd</span>)
        <span class="pl-s1">rospy</span>.<span class="pl-c1">sleep</span>(<span class="pl-c1">0.01</span>)  <span class="pl-c"># 10ms间隔</span>
    
    <span class="pl-c"># 取消所有导航目标</span>
    <span class="pl-k">if</span> <span class="pl-s1">self</span>.<span class="pl-c1">nav_client</span>:
        <span class="pl-s1">self</span>.<span class="pl-c1">nav_client</span>.<span class="pl-c1">cancel_all_goals</span>()
    
    <span class="pl-c"># 标记系统为非活动状态</span>
    <span class="pl-s1">self</span>.<span class="pl-c1">active</span> <span class="pl-c1">=</span> <span class="pl-c1">False</span>
    
    <span class="pl-s1">rospy</span>.<span class="pl-c1">loginfo</span>(<span class="pl-s">"机器人已安全停止，系统即将退出"</span>)
    <span class="pl-s1">rospy</span>.<span class="pl-c1">signal_shutdown</span>(<span class="pl-s">"用户中断"</span>)</pre></div>
<h3>（五）任务调度与服务接口</h3>
<p>以下代码展示了任务调度和服务接口的实现，实现了模块化的任务执行：</p>
<div class="highlight highlight-source-python"><pre class="notranslate"><span class="pl-k">def</span> <span class="pl-en">handle_request</span>(<span class="pl-s1">self</span>, <span class="pl-s1">req</span>):
    <span class="pl-s">"""处理救援任务请求</span>
<span class="pl-s">    </span>
<span class="pl-s">    Args:</span>
<span class="pl-s">        req: 包含任务区域的请求对象</span>
<span class="pl-s">        </span>
<span class="pl-s">    Returns:</span>
<span class="pl-s">        任务执行结果</span>
<span class="pl-s">    """</span>
    <span class="pl-s1">rospy</span>.<span class="pl-c1">loginfo</span>(<span class="pl-s">f"收到救援任务请求: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">req</span>.<span class="pl-c1">data</span><span class="pl-kos">}</span></span>"</span>)
    
    <span class="pl-c"># 取消当前任务（如果有）</span>
    <span class="pl-k">if</span> <span class="pl-s1">self</span>.<span class="pl-c1">nav_client</span>.<span class="pl-c1">get_state</span>() <span class="pl-c1">in</span> [<span class="pl-v">GoalStatus</span>.<span class="pl-c1">ACTIVE</span>, <span class="pl-v">GoalStatus</span>.<span class="pl-c1">PENDING</span>]:
        <span class="pl-s1">self</span>.<span class="pl-c1">nav_client</span>.<span class="pl-c1">cancel_all_goals</span>()
        <span class="pl-s1">rospy</span>.<span class="pl-c1">loginfo</span>(<span class="pl-s">"已取消当前任务"</span>)
    
    <span class="pl-c"># 根据请求区域执行对应任务</span>
    <span class="pl-k">if</span> <span class="pl-s1">req</span>.<span class="pl-c1">data</span> <span class="pl-c1">==</span> <span class="pl-s">"A"</span>:
        <span class="pl-s1">self</span>.<span class="pl-c1">processA</span>()
        <span class="pl-k">return</span> <span class="pl-en">String</span>(<span class="pl-s">"A区任务执行完毕"</span>)
    <span class="pl-k">elif</span> <span class="pl-s1">req</span>.<span class="pl-c1">data</span> <span class="pl-c1">==</span> <span class="pl-s">"B"</span>:
        <span class="pl-s1">self</span>.<span class="pl-c1">processB</span>()
        <span class="pl-k">return</span> <span class="pl-en">String</span>(<span class="pl-s">"B区任务执行完毕"</span>)
    <span class="pl-k">elif</span> <span class="pl-s1">req</span>.<span class="pl-c1">data</span> <span class="pl-c1">==</span> <span class="pl-s">"C"</span>:
        <span class="pl-s1">self</span>.<span class="pl-c1">processC</span>()
        <span class="pl-k">return</span> <span class="pl-en">String</span>(<span class="pl-s">"C区任务执行完毕"</span>)
    <span class="pl-k">elif</span> <span class="pl-s1">req</span>.<span class="pl-c1">data</span> <span class="pl-c1">==</span> <span class="pl-s">"D"</span>:
        <span class="pl-s1">self</span>.<span class="pl-c1">processD</span>()
        <span class="pl-k">return</span> <span class="pl-en">String</span>(<span class="pl-s">"D区任务执行完毕"</span>)
    <span class="pl-k">else</span>:
        <span class="pl-k">return</span> <span class="pl-en">String</span>(<span class="pl-s">f"未知区域: <span class="pl-s1"><span class="pl-kos">{</span><span class="pl-s1">req</span>.<span class="pl-c1">data</span><span class="pl-kos">}</span></span>"</span>)

<span class="pl-k">def</span> <span class="pl-en">processA</span>(<span class="pl-s1">self</span>):
    <span class="pl-s">"""A区救援任务"""</span>
    <span class="pl-s1">rospy</span>.<span class="pl-c1">loginfo</span>(<span class="pl-s">"开始执行A区救援任务"</span>)
    <span class="pl-s1">goals</span> <span class="pl-c1">=</span> [
        <span class="pl-s1">self</span>.<span class="pl-c1">create_goal</span>(<span class="pl-c1">1.5</span>, <span class="pl-c1">2.1</span>, <span class="pl-c1">0</span>, <span class="pl-c1">1</span>),  <span class="pl-c"># 到达A点</span>
    ]
    <span class="pl-k">if</span> <span class="pl-s1">self</span>.<span class="pl-c1">execute_mission</span>(<span class="pl-s1">goals</span>, <span class="pl-s">"A"</span>):
        <span class="pl-s1">rospy</span>.<span class="pl-c1">loginfo</span>(<span class="pl-s">"到达A区，正在接收伤员..."</span>)
        <span class="pl-s1">self</span>.<span class="pl-c1">detect</span>(<span class="pl-s">"test1.jpg"</span>, <span class="pl-c1">0.5</span>)
        <span class="pl-s1">time</span>.<span class="pl-c1">sleep</span>(<span class="pl-c1">3</span>)
        
        <span class="pl-c"># 返回营地</span>
        <span class="pl-s1">rospy</span>.<span class="pl-c1">loginfo</span>(<span class="pl-s">"A区任务完成，返回营地"</span>)
        <span class="pl-s1">return_goals</span> <span class="pl-c1">=</span> [
            <span class="pl-s1">self</span>.<span class="pl-c1">create_goal</span>(<span class="pl-c1">0</span>, <span class="pl-c1">0</span>, <span class="pl-c1">0</span>, <span class="pl-c1">1</span>),  <span class="pl-c"># 返回营地</span>
        ]
        <span class="pl-s1">self</span>.<span class="pl-c1">execute_mission</span>(<span class="pl-s1">return_goals</span>, <span class="pl-s">"A"</span>)
    <span class="pl-k">else</span>:
        <span class="pl-s1">rospy</span>.<span class="pl-c1">logerr</span>(<span class="pl-s">"A区任务失败"</span>)</pre></div>
<p>以上代码片段展示了项目的核心技术实现，包括多地形自适应导航、目标识别、徘徊脱困、紧急终止和任务调度等关键功能。这些代码共同构成了一个完整的智能侦察机器人系统，能够在复杂环境中高效完成任务。</p></div>
<div style="font-size:small;margin-top:8px;float:right;"></div>

<button class="btn btn-block" type="button" onclick="openComments()" id="cmButton">评论</button>
<div class="comments" id="comments"></div>

</div>
    <div id="footer"><div id="footer1">Copyright © <span id="copyrightYear"></span> <a href="https://wzh922.github.io/blog">狒材的blog</a></div>
<div id="footer2">
    <span id="runday"></span><span>Powered by <a href="https://meekdai.com/Gmeek.html" target="_blank">Gmeek</a></span>
</div>

<script>
var now=new Date();
document.getElementById("copyrightYear").innerHTML=now.getFullYear();

if(""!=""){
    var startSite=new Date("");
    var diff=now.getTime()-startSite.getTime();
    var diffDay=Math.floor(diff/(1000*60*60*24));
    document.getElementById("runday").innerHTML="网站运行"+diffDay+"天"+" • ";
}
</script></div>
</body>
<script>
var IconList={'sun': 'M8 10.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5zM8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0V.75A.75.75 0 018 0zm0 13a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 018 13zM2.343 2.343a.75.75 0 011.061 0l1.06 1.061a.75.75 0 01-1.06 1.06l-1.06-1.06a.75.75 0 010-1.06zm9.193 9.193a.75.75 0 011.06 0l1.061 1.06a.75.75 0 01-1.06 1.061l-1.061-1.06a.75.75 0 010-1.061zM16 8a.75.75 0 01-.75.75h-1.5a.75.75 0 010-1.5h1.5A.75.75 0 0116 8zM3 8a.75.75 0 01-.75.75H.75a.75.75 0 010-1.5h1.5A.75.75 0 013 8zm10.657-5.657a.75.75 0 010 1.061l-1.061 1.06a.75.75 0 11-1.06-1.06l1.06-1.06a.75.75 0 011.06 0zm-9.193 9.193a.75.75 0 010 1.06l-1.06 1.061a.75.75 0 11-1.061-1.06l1.06-1.061a.75.75 0 011.061 0z', 'moon': 'M9.598 1.591a.75.75 0 01.785-.175 7 7 0 11-8.967 8.967.75.75 0 01.961-.96 5.5 5.5 0 007.046-7.046.75.75 0 01.175-.786zm1.616 1.945a7 7 0 01-7.678 7.678 5.5 5.5 0 107.678-7.678z', 'sync': 'M1.705 8.005a.75.75 0 0 1 .834.656 5.5 5.5 0 0 0 9.592 2.97l-1.204-1.204a.25.25 0 0 1 .177-.427h3.646a.25.25 0 0 1 .25.25v3.646a.25.25 0 0 1-.427.177l-1.38-1.38A7.002 7.002 0 0 1 1.05 8.84a.75.75 0 0 1 .656-.834ZM8 2.5a5.487 5.487 0 0 0-4.131 1.869l1.204 1.204A.25.25 0 0 1 4.896 6H1.25A.25.25 0 0 1 1 5.75V2.104a.25.25 0 0 1 .427-.177l1.38 1.38A7.002 7.002 0 0 1 14.95 7.16a.75.75 0 0 1-1.49.178A5.5 5.5 0 0 0 8 2.5Z', 'home': 'M6.906.664a1.749 1.749 0 0 1 2.187 0l5.25 4.2c.415.332.657.835.657 1.367v7.019A1.75 1.75 0 0 1 13.25 15h-3.5a.75.75 0 0 1-.75-.75V9H7v5.25a.75.75 0 0 1-.75.75h-3.5A1.75 1.75 0 0 1 1 13.25V6.23c0-.531.242-1.034.657-1.366l5.25-4.2Zm1.25 1.171a.25.25 0 0 0-.312 0l-5.25 4.2a.25.25 0 0 0-.094.196v7.019c0 .138.112.25.25.25H5.5V8.25a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 .75.75v5.25h2.75a.25.25 0 0 0 .25-.25V6.23a.25.25 0 0 0-.094-.195Z', 'github': 'M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z', 'copy': 'M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z', 'check': 'M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z'};
var utterancesLoad=0;

let themeSettings={
    "dark": ["dark","moon","#00f0ff","dark-blue"],
    "light": ["light","sun","#ff5000","github-light"],
    "auto": ["auto","sync","","preferred-color-scheme"]
};
function changeTheme(mode, icon, color, utheme){
    document.documentElement.setAttribute("data-color-mode",mode);
    document.getElementById("themeSwitch").setAttribute("d",value=IconList[icon]);
    document.getElementById("themeSwitch").parentNode.style.color=color;
    if(utterancesLoad==1){utterancesTheme(utheme);}
}
function modeSwitch(){
    let currentMode=document.documentElement.getAttribute('data-color-mode');
    let newMode = currentMode === "light" ? "dark" : currentMode === "dark" ? "auto" : "light";
    localStorage.setItem("meek_theme", newMode);
    if(themeSettings[newMode]){
        changeTheme(...themeSettings[newMode]);
    }
}
function utterancesTheme(theme){
    const message={type:'set-theme',theme: theme};
    const iframe=document.getElementsByClassName('utterances-frame')[0];
    iframe.contentWindow.postMessage(message,'https://utteranc.es');
}
if(themeSettings[theme]){changeTheme(...themeSettings[theme]);}
console.log("\n %c Gmeek last https://github.com/Meekdai/Gmeek \n","padding:5px 0;background:#02d81d;color:#fff");
</script>

<script>
document.getElementById("pathHome").setAttribute("d",IconList["home"]);
document.getElementById("pathIssue").setAttribute("d",IconList["github"]);



function openComments(){
    cm=document.getElementById("comments");
    cmButton=document.getElementById("cmButton");
    cmButton.innerHTML="loading";
    span=document.createElement("span");
    span.setAttribute("class","AnimatedEllipsis");
    cmButton.appendChild(span);

    script=document.createElement("script");
    script.setAttribute("src","https://utteranc.es/client.js");
    script.setAttribute("repo","wzh922/blog");
    script.setAttribute("issue-term","title");
    
    if(localStorage.getItem("meek_theme")=="dark"){script.setAttribute("theme","dark-blue");}
    else if(localStorage.getItem("meek_theme")=="light") {script.setAttribute("theme","github-light");}
    else{script.setAttribute("theme","preferred-color-scheme");}
    
    script.setAttribute("crossorigin","anonymous");
    script.setAttribute("async","");
    cm.appendChild(script);

    int=self.setInterval("iFrameLoading()",200);
}

function iFrameLoading(){
    var utterances=document.getElementsByClassName('utterances');
    if(utterances.length==1){
        if(utterances[0].style.height!=""){
            utterancesLoad=1;
            int=window.clearInterval(int);
            document.getElementById("cmButton").style.display="none";
            console.log("utterances Load OK");
        }
    }
}

document.addEventListener('DOMContentLoaded', () => {
    const createClipboardHTML = (codeContent, additionalClasses = '') => `
        <pre class="notranslate"><code class="notranslate">${codeContent}</code></pre>
        <div class="clipboard-container position-absolute right-0 top-0 ${additionalClasses}">
            <clipboard-copy class="ClipboardButton btn m-2 p-0" role="button" style="display: inherit;">
                <svg height="16" width="16" class="octicon octicon-copy m-2"><path d="${IconList["copy"]}"></path></svg>
                <svg height="16" width="16" class="octicon octicon-check color-fg-success m-2 d-none"><path d="${IconList["check"]}"></path></svg>
            </clipboard-copy>
            <div class="copy-feedback">Copied!</div>
        </div>
    `;

    const handleCodeElements = (selector = '') => {
        document.querySelectorAll(selector).forEach(codeElement => {
            const codeContent = codeElement.innerHTML;
            const newStructure = document.createElement('div');
            newStructure.className = 'snippet-clipboard-content position-relative overflow-auto';
            newStructure.innerHTML = createClipboardHTML(codeContent);

            const parentElement = codeElement.parentElement;
            if (selector.includes('highlight')) {
                parentElement.insertBefore(newStructure, codeElement.nextSibling);
                parentElement.removeChild(codeElement);
            } else {
                parentElement.parentElement.replaceChild(newStructure, parentElement);
            }
        });
    };

    handleCodeElements('pre.notranslate > code.notranslate');
    handleCodeElements('div.highlight > pre.notranslate');

    let currentFeedback = null;
    document.querySelectorAll('clipboard-copy').forEach(copyButton => {
        copyButton.addEventListener('click', () => {
            const codeContent = copyButton.closest('.snippet-clipboard-content').innerText;
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = codeContent;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextArea);

            const copyIcon = copyButton.querySelector('.octicon-copy');
            const checkIcon = copyButton.querySelector('.octicon-check');
            const copyFeedback = copyButton.nextElementSibling;

            if (currentFeedback && currentFeedback !== copyFeedback) {currentFeedback.style.display = 'none';}
            currentFeedback = copyFeedback;

            copyIcon.classList.add('d-none');
            checkIcon.classList.remove('d-none');
            copyFeedback.style.display = 'block';
            copyButton.style.borderColor = 'var(--color-success-fg)';

            setTimeout(() => {
                copyIcon.classList.remove('d-none');
                checkIcon.classList.add('d-none');
                copyFeedback.style.display = 'none';
                copyButton.style.borderColor = '';
            }, 2000);
        });
    });
});

</script>


</html>
